(function(){function M(){const g=document.querySelector("#overlaps");if(!g)return;const y=g.querySelectorAll("thead th");y.forEach(f=>{f.addEventListener("click",()=>{const C=g.querySelector("tbody"),i=Array.from(C.querySelectorAll("tr")),c=Array.from(y).indexOf(f),u=f.classList.contains("asc");y.forEach(l=>{l.classList.remove("asc","desc");const r=l.querySelector(".sort-icon");r&&(r.style.display="none")}),i.sort((l,r)=>{const p=l.children[c].textContent.trim(),d=r.children[c].textContent.trim();return u?p.localeCompare(d):d.localeCompare(p)}),i.forEach(l=>C.appendChild(l)),f.classList.toggle("asc",!u),f.classList.toggle("desc",u);let h=f.querySelector(".sort-icon");h.style.display="inline"})})}(function(){const g={true:{hex:"#15803d",tw:"text-green-700"},false:{hex:"#be123c",tw:"text-red-700"}};function y(i){console.log("Flashing element:",i),i.classList.add("flash"),setTimeout(()=>{i.classList.remove("flash")},1e3)}function f(i){let c=!0;const u=1.05,h=.95;let l=0;const r=2,p=i.getRadius(),d=1500;function x(){if(l>=r)return;let t=i.getRadius(),$=t*.0085;c?(t+=$,t>=p*u&&(c=!1)):(t-=$,t<=p*h&&(c=!0,l++)),i.setRadius(t),i.setOptions({fillOpacity:.35*(t/p)}),l<r&&setTimeout(x,d/60)}x()}function C(){console.log("Initializing map...");const i=document.getElementById("map"),c=document.getElementById("loading-indicator"),u=new google.maps.Map(document.getElementById("map"),{center:{lat:37.0902,lng:-95.7129},zoom:4}),h=[],l=new google.maps.LatLngBounds,r=new google.maps.InfoWindow,p=i.dataset.fetchLocationsUrl??"/leadflex/map/locations";fetch(p).then(d=>(console.log("Fetching locations..."),d.json())).then(d=>{console.log("Locations fetched:",d);const x=d.data;c&&(c.style.display="none"),x.forEach(t=>{if(!t.location.coords.lat||!t.location.coords.lng){console.error("Invalid coordinates for job:",t.title);return}console.log("Creating circle for location:",t.title);const $=new google.maps.Circle({strokeColor:t.circle.strokeColor??g[t.advertiseJob].hex,strokeOpacity:t.circle.strokeOpacity??.8,strokeWeight:t.circle.strokeWeight??2,fillColor:t.circle.fillColor??g[t.advertiseJob].hex,fillOpacity:t.circle.fillOpacity??.6,map:u,center:t.location.coords,radius:t.hiringRadius});l.extend(t.location.coords),h.push({circle:$,id:t.id,title:t.title,data:t}),$.addListener("click",E=>{console.log(`Circle for ${t.title} clicked at:`,E.latLng);const I=E.latLng,w=[];if(h.forEach(({circle:v,data:o})=>{const e=v.getCenter(),m=google.maps.geometry.spherical.computeDistanceBetween(e,I);console.log(`Checking circle for ${o.title}: Distance = ${m}, Radius = ${v.getRadius()}`),m<=v.getRadius()&&(console.log(`Circle for ${o.title} overlaps with click location.`),w.push(o))}),w.length>0){console.log("Overlapping jobs found:",w);const v=document.querySelector("#overlaps tbody");v.innerHTML="";let o="<div class='info-window-content'>";w.forEach((e,m)=>{let k=(e.advertiseJob?"check":"x")+"-square-fill",a=document.createElement("svg");a.className=`h-4 w-4 mx-2 ${g[e.advertiseJob].tw}`;let L=document.createElement("use");L.setAttribute("xlink:href",`#${k}`),a.appendChild(L);const n=document.createElement("tr");n.className="border-t border-gray-300 job-info",n.dataset.job=JSON.stringify(e),n.dataset.jobId=e.id;let s="px-4 py-2 border-b border-gray-300";n.innerHTML+=`<td class="${s}">${e.id}</td>`,n.innerHTML+=`<td class="${s}">${e.title}</td>`,n.innerHTML+=`<td class="${s}">${e.types.driver}</td>`,n.innerHTML+=`<td class="${s}">${e.types.trailer}</td>`,n.innerHTML+=`<td class="${s}">${e.types.job}</td>`,n.innerHTML+=`<td class="${s}">${e.location.city}</td>`,n.innerHTML+=`<td class="${s}">${e.location.state}</td>`,n.innerHTML+=`<td class="${s}">${Math.round(e.hiringRadius/1609.34)}</td>`,n.innerHTML+=`<td class="${s}">${e.assignedCampaigns}</td>`,n.innerHTML+=`<td class="${s}">
                                    <div class="flex items-center justify-center" data-modal-triggers>
                                        <svg class="h-4 w-4 mx-2 ${e.advertiseJob?g[e.advertiseJob].tw:""}" data-advertise=true>
                                            <use xlink:href="#check-square-fill"></use>
                                        </svg>
                                        <svg class="h-4 w-4 mx-2 ${e.advertiseJob?"":g[e.advertiseJob].tw}" data-advertise=false>
                                            <use xlink:href="#x-square-fill"></use>
                                        </svg>
                                    </div>
                                  </td>`,n.innerHTML+=`<td class="${s}">
                                    <a href="${e.url}" target="_blank" class="text-blue-500 hover:underline">View Job</a> 
                                  </td>`,v.appendChild(n),a.className=`h-2 w-2 mr-1 ${g[e.advertiseJob].tw}`,o+=`<div class='job-info py-2' data-job-id='${e.id}'>`,o+=`<a class="underline blue-700" href='${e.url}' target='_blank'>`,o+=`<h3><span class="flex items-center">${a.outerHTML}${e.title}</span></h3>`,o+="</a>",o+="<ul class='list-disc pl-6'>",e.additionalInfo.forEach(T=>{o+=`<li><strong>${T.label}:</strong> ${T.value}</li>`}),o+=`<li><strong>ID:</strong> ${e.id}</li>`,o+=`<li><strong>Driver Type:</strong> ${e.types.driver}</li>`,o+=`<li><strong>Trailer Type:</strong> ${e.types.trailer}</li>`,o+=`<li><strong>Job Type:</strong> ${e.types.job}</li>`,o+=`<li><strong>City:</strong> ${e.location.city}</li>`,o+=`<li><strong>Assigned Campaign:</strong> ${e.assignedCampaigns?e.assignedCampaigns:"<i>none</i>"}</li>`,o+="</ul>",o+="</div>",m<w.length-1&&(o+="<hr>")}),o+="</div>",r.close(),r.setContent(o),r.setPosition(I),r.open(u),google.maps.event.addListenerOnce(r,"domready",()=>{const e=document.querySelector(".gm-ui-hover-effect");e&&e.focus(),document.querySelectorAll(".job-info").forEach(m=>{console.log(m),m.addEventListener("click",k=>{k.preventDefault();const a=parseInt(m.getAttribute("data-job-id"));if(isNaN(a)){console.error("Invalid jobId:",a);return}console.log("Job info clicked:",a);const L=h.find(T=>T.data.id===a);L?f(L.circle):console.error("Circle not found for job:",a);const n=document.querySelector(`tr[data-job-id="${a}"]`);n?y(n):console.error("Row not found for job:",a);const s=document.querySelector(`.info-window-content .job-info[data-job-id="${a}"]`);s?y(s):console.error("Info window not found")})})}),M()}else console.log("No overlapping circles found.")})}),u.fitBounds(l)}).catch(d=>{console.error("Error fetching locations:",d),c&&(c.style.display="none")})}window.onload=C})();
//# sourceMappingURL=map.js.map
})()