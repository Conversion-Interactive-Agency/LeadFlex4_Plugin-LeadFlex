var zn=Object.defineProperty;var Wn=(n,e,t)=>e in n?zn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var S=(n,e,t)=>(Wn(n,typeof e!="symbol"?e+"":e,t),t);const Yn="modulepreload",Xn=function(n){return"/"+n},Et={},qn=function(e,t,s){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=Xn(r),r in Et)return;Et[r]=!0;const a=r.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!s)for(let f=i.length-1;f>=0;f--){const y=i[f];if(y.href===r&&(!a||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${l}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":Yn,a||(d.as="script",d.crossOrigin=""),d.href=r,document.head.appendChild(d),a)return new Promise((f,y)=>{d.addEventListener("load",f),d.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e()).catch(r=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r})};function _(n){return n!=null&&typeof n=="object"&&n["@@functional/placeholder"]===!0}function Q(n){return function e(t){return arguments.length===0||_(t)?e:n.apply(this,arguments)}}function Y(n){return function e(t,s){switch(arguments.length){case 0:return e;case 1:return _(t)?e:Q(function(i){return n(t,i)});default:return _(t)&&_(s)?e:_(t)?Q(function(i){return n(i,s)}):_(s)?Q(function(i){return n(t,i)}):n(t,s)}}}function gt(n){return function e(t,s,i){switch(arguments.length){case 0:return e;case 1:return _(t)?e:Y(function(r,a){return n(t,r,a)});case 2:return _(t)&&_(s)?e:_(t)?Y(function(r,a){return n(r,s,a)}):_(s)?Y(function(r,a){return n(t,r,a)}):Q(function(r){return n(t,s,r)});default:return _(t)&&_(s)&&_(i)?e:_(t)&&_(s)?Y(function(r,a){return n(r,a,i)}):_(t)&&_(i)?Y(function(r,a){return n(r,s,a)}):_(s)&&_(i)?Y(function(r,a){return n(t,r,a)}):_(t)?Q(function(r){return n(r,s,i)}):_(s)?Q(function(r){return n(t,r,i)}):_(i)?Q(function(r){return n(t,s,r)}):n(t,s,i)}}}function Ae(n,e){return Object.prototype.hasOwnProperty.call(e,n)}var Jn=Q(function(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function yt(n){return Object.prototype.toString.call(n)==="[object Object]"}const Zn=Number.isInteger||function(e){return e<<0===e};function es(n){return Object.prototype.toString.call(n)==="[object String]"}function ts(n,e){var t=n<0?e.length+n:n;return es(e)?e.charAt(t):e[t]}function ns(n){return new RegExp(n.source,n.flags?n.flags:(n.global?"g":"")+(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.sticky?"y":"")+(n.unicode?"u":"")+(n.dotAll?"s":""))}function Zt(n,e,t){if(t||(t=new is),ss(n))return n;var s=function(r){var a=t.get(n);if(a)return a;t.set(n,r);for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=Zt(n[l],!0,t));return r};switch(Jn(n)){case"Object":return s(Object.create(Object.getPrototypeOf(n)));case"Array":return s(Array(n.length));case"Date":return new Date(n.valueOf());case"RegExp":return ns(n);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return n.slice();default:return n}}function ss(n){var e=typeof n;return n==null||e!="object"&&e!="function"}var is=function(){function n(){this.map={},this.length=0}return n.prototype.set=function(e,t){var s=this.hash(e),i=this.map[s];i||(this.map[s]=i=[]),i.push([e,t]),this.length+=1},n.prototype.hash=function(e){var t=[];for(var s in e)t.push(Object.prototype.toString.call(e[s]));return t.join()},n.prototype.get=function(e){if(this.length<=180){for(var t in this.map)for(var a=this.map[t],s=0;s<a.length;s+=1){var i=a[s];if(i[0]===e)return i[1]}return}var r=this.hash(e),a=this.map[r];if(a)for(var s=0;s<a.length;s+=1){var i=a[s];if(i[0]===e)return i[1]}},n}(),b=Q(function(e){return e!=null&&typeof e.clone=="function"?e.clone():Zt(e)});function rs(n,e){for(var t=e,s=0;s<n.length;s+=1){if(t==null)return;var i=n[s];Zn(i)?t=ts(i,t):t=t[i]}return t}var os=gt(function(e,t,s){var i={},r;t=t||{},s=s||{};for(r in t)Ae(r,t)&&(i[r]=Ae(r,s)?e(r,t[r],s[r]):t[r]);for(r in s)Ae(r,s)&&!Ae(r,i)&&(i[r]=s[r]);return i}),as=gt(function n(e,t,s){return os(function(i,r,a){return yt(r)&&yt(a)?n(e,r,a):e(i,r,a)},t,s)}),ls=gt(function(e,t,s){return as(function(i,r,a){return e(r,a)},t,s)}),us=Y(rs),en=Y(function(e,t){var s={};for(var i in t)e(t[i],i,t)&&(s[i]=t[i]);return s});const g=n=>typeof n=="function"&&!!(n.constructor&&n.call&&n.apply),C=n=>typeof n=="string",x=n=>n===null,D=n=>typeof n>"u",H=n=>x(n)||D(n),A=n=>!D(n),de=n=>!H(n),cs=n=>de(n)&&n!=="",tn=n=>n instanceof Error,Je=(n,e)=>{const t=e.split(".");return us(t,n)},ds=(n,e)=>!!Je(n,e),nn=n=>!x(n)&&typeof n=="object"&&!Array.isArray(n),v=n=>!x(n)&&Object.prototype.toString.call(n)==="[object Object]",gs=(n,e)=>{if(!Array.isArray(n)||!Array.isArray(e))return b(e);const t=b(n);return e.forEach((s,i)=>{t[i]=Array.isArray(s)||nn(s)?N(t[i],s):s}),t},N=(n,e)=>ls(gs,n,e),Be=n=>v(n)&&Object.keys(n).length>0,pe=n=>{const e=en(A,n);return Object.keys(e).forEach(t=>{const s=e[t];v(s)&&(e[t]=pe(s))}),e},te=n=>{const e=en(de,n);return Object.keys(e).forEach(t=>{const s=e[t];v(s)&&(e[t]=te(s))}),e},hs=n=>n.replace(/^\s+|\s+$/gm,""),fs=n=>n.replace(/ {2,}/g," "),we=n=>{let e=n;if(!C(n)&&!H(n))try{e=JSON.stringify(n)}catch{e=null}return e},ps=n=>{const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return globalThis.btoa(e)},vs=n=>ps(new TextEncoder().encode(n)),Me=(n,e,t,s,i)=>{const r={category:n,name:e,properties:t,options:s};return g(i)&&(r.callback=i),g(s)&&(r.category=n,r.name=e,r.properties=t,delete r.options,r.callback=s),g(t)&&(r.category=n,r.name=e,delete r.properties,delete r.options,r.callback=t),g(e)&&(r.category=n,delete r.name,delete r.properties,delete r.options,r.callback=e),g(n)&&(delete r.category,delete r.name,delete r.properties,delete r.options,r.callback=n),v(n)?(delete r.name,delete r.category,r.properties=n,r.options=e):v(e)&&(delete r.name,r.properties=e,r.options=g(t)?null:t),C(n)&&!C(e)&&(delete r.category,r.name=n),A(r.category)||delete r.category,A(r.name)||delete r.name,r.properties=r.properties?b(r.properties):{},A(r.options)?r.options=b(r.options):delete r.options,r.properties=N(v(r.properties)?r.properties:{},{name:C(r.name)?r.name:null,category:C(r.category)?r.category:null}),r},ht=(n,e,t,s)=>{const i={name:n,properties:e,options:t};return g(s)&&(i.callback=s),g(t)&&(i.properties=e,delete i.options,i.callback=t),g(e)&&(delete i.properties,delete i.options,i.callback=e),i.properties=de(i.properties)?b(i.properties):{},A(i.options)?i.options=b(i.options):delete i.options,i},sn=(n,e,t,s)=>{const i={userId:n,traits:e,options:t};return g(s)&&(i.callback=s),g(t)&&(i.userId=n,i.traits=e,delete i.options,i.callback=t),g(e)&&(i.userId=n,delete i.traits,delete i.options,i.callback=e),(v(n)||x(n))&&(i.userId=null,i.traits=n,i.options=e),A(i.userId)?i.userId=we(i.userId):delete i.userId,v(i.traits)?i.traits=b(i.traits):delete i.traits,A(i.options)?i.options=b(i.options):delete i.options,i},rn=(n,e,t,s)=>{const i={to:n,from:e,options:t};return g(s)&&(i.callback=s),g(t)&&(i.to=n,i.from=e,delete i.options,i.callback=t),g(e)?(i.to=n,delete i.from,delete i.options,i.callback=e):(v(e)||x(e))&&(i.to=n,delete i.from,i.options=e),g(n)?(delete i.to,delete i.from,delete i.options,i.callback=n):(v(n)||x(n))&&(delete i.to,delete i.from,i.options=n),A(i.to)?i.to=we(i.to):delete i.to,A(i.from)?i.from=we(i.from):delete i.from,A(i.options)?i.options=b(i.options):delete i.options,i},on=(n,e,t,s)=>{const i={groupId:n,traits:e,options:t};return g(s)&&(i.callback=s),g(t)&&(i.groupId=n,i.traits=e,delete i.options,i.callback=t),g(e)&&(i.groupId=n,delete i.traits,delete i.options,i.callback=e),g(n)?(i.groupId=null,delete i.traits,delete i.options,i.callback=n):(v(n)||x(n))&&(i.groupId=null,i.traits=n,i.options=g(e)?null:e),A(i.groupId)?i.groupId=we(i.groupId):delete i.groupId,i.traits=v(i.traits)?b(i.traits):{},A(i.options)?i.options=b(i.options):delete i.options,i},Ze="CapabilitiesManager",K="ConfigManager",an="EventManager",mt="PluginsManager",ve="UserSessionManager",_e="ErrorHandler",re="PluginEngine",St="StoreManager",Es="readyApi",ys="EventRepository",ms="ExternalSrcLoader",Ss="HttpClient",bt="RudderStackApplication",Ve="AnalyticsCore",Rt="RudderLabs JavaScript SDK",me="3.5.2",bs="com.rudderlabs.javascript",ln="npm",It="RudderJS-Initiated",Rs="ad-block page request",Is="/ad-blocked",et="preloadedEventsBuffer",Ts="Consent Management Interaction",As="ajs_trait_",_s="ajs_prop_",Tt="ajs_aid",At="ajs_uid",_t="ajs_event",Os=10*1e3,Ps=31536e3*1e3,Se=30*60*1e3,Ot=10*1e3,Ns=10*1e3,ks=250,un=(n="app")=>{globalThis.RudderStackGlobals||(globalThis.RudderStackGlobals={}),globalThis.RudderStackGlobals[n]||(globalThis.RudderStackGlobals[n]={})},Ge=(n,e,t="app")=>{un(t),globalThis.RudderStackGlobals[t][n]=e},Cs=(n,e="app")=>(un(e),globalThis.RudderStackGlobals[e][n]);function Ds(n,e,t=ks){let s;return(...i)=>{globalThis.clearTimeout(s),s=globalThis.setTimeout(()=>{n.apply(e,i)},t)}}const Pt=(n,e)=>{const t={};return n.forEach((s,i)=>{if(i.startsWith(e)){const r=i.substring(e.length);t[r]=n.get(i)}}),t},Ls=(n=[])=>{const e={trait:As,properties:_s},t=new URLSearchParams(globalThis.location.search);t.get(_t)&&n.unshift(["track",t.get(_t),Pt(t,e.properties)]),t.get(At)&&n.unshift(["identify",t.get(At),Pt(t,e.trait)]),t.get(Tt)&&n.unshift(["setAnonymousId",t.get(Tt)])},ws=n=>{const e="load";let t=[],s=0;for(;s<n.length;){if(n[s]&&n[s][0]===e){t=b(n[s]),n.splice(s,1);break}s+=1}return t},Ms=n=>{const e="consent",t=n.filter(i=>i[0]===e),s=n.filter(i=>i[0]!==e);n.splice(0,n.length,...t,...s)},Us=n=>{const e=Cs(et)||[];Ls(e),e.length>0&&(n.enqueuePreloadBufferEvents(e),Ge(et,[]))},$s=(n,e)=>{const t=n.shift();let s;if(g(e[t])){switch(t){case"page":s=Me(...n);break;case"track":s=ht(...n);break;case"identify":s=sn(...n);break;case"alias":s=rn(...n);break;case"group":s=on(...n);break;default:e[t](...n);break}s&&e[t](s)}},Bs=10*1e3,E=":: ",Gs=n=>`A script with the id "${n}" is already loaded. Skipping the loading of this script to prevent conflicts.`,Nt=(n,e)=>`Failed to load the script with the id "${n}" from URL "${e}".`,Fs=(n,e,t)=>`A timeout of ${t} ms occurred while trying to load the script with id "${n}" from URL "${e}".`,xs=(n,e)=>`${n}${E}A circular reference has been detected in the object and the property "${e}" has been dropped from the output.`,Hs="Failed to convert the value to a JSON string.",js="JSONStringify",Vs=(n,e,t)=>{const s=[];return function(i,r){if(!(e!=null&&e.includes(i))&&!(n&&H(r))){if(typeof r!="object"||x(r))return r;for(;s.length>0&&s[s.length-1]!==this;)s.pop();return s.includes(r)?(t==null||t.warn(xs(js,i)),"[Circular Reference]"):(s.push(r),r)}}},q=(n,e,t,s)=>{try{return JSON.stringify(n,Vs(e,t,s))}catch(i){return s==null||s.warn(Hs,i),null}},Re=(n,e)=>{let t=n;return tn(n)?t.message=`${e}: ${n.message}`:t=new Error(`${e}: ${q(n)}`),t},Ks="RS_JS_SDK",Qs=(n,e,t=!0,s=null,i=null,r={})=>{const a=document.createElement("script");return a.type="text/javascript",a.onload=s,a.onerror=i,a.src=n,a.id=e,a.async=t,Object.keys(r).forEach(l=>{a.setAttribute(l,r[l])}),a.setAttribute("data-loader",Ks),a},zs=n=>{var r,a,l,u;const e=document.getElementsByTagName("head");if(e.length>0){(a=e[0])==null||a.insertBefore(n,(r=e[0])==null?void 0:r.firstChild);return}const t=document.getElementsByTagName("script");if(t.length>0&&((l=t[0])!=null&&l.parentNode)){(u=t[0])==null||u.parentNode.insertBefore(n,t[0]);return}const s=document.createElement("head");s.appendChild(n);const i=document.getElementsByTagName("html")[0];i==null||i.insertBefore(s,i.firstChild)},Ws=(n,e,t,s=!0,i)=>new Promise((r,a)=>{document.getElementById(e)&&a(new Error(Gs(e)));try{let u;zs(Qs(n,e,s,()=>{globalThis.clearTimeout(u),r(e)},()=>{globalThis.clearTimeout(u),a(new Error(Nt(e,n)))},i)),u=globalThis.setTimeout(()=>{a(new Error(Fs(e,n,t)))},t)}catch(u){a(Re(u,Nt(e,n)))}});class cn{constructor(e,t,s=Bs){S(this,"hasErrorHandler",!1);this.errorHandler=e,this.logger=t,this.timeout=s,this.hasErrorHandler=!!this.errorHandler,this.onError=this.onError.bind(this)}loadJSFile(e){const{url:t,id:s,timeout:i,async:r,callback:a,extraAttributes:l}=e,u=!g(a);Ws(t,s,i||this.timeout,r,l).then(d=>{u||a(d)}).catch(d=>{this.onError(d),u||a()})}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,ms);else throw e}}var Ys=Symbol.for("preact-signals");function Fe(){if(Z>1)Z--;else{for(var n,e=!1;ye!==void 0;){var t=ye;for(ye=void 0,tt++;t!==void 0;){var s=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&gn(t))try{t.c()}catch(i){e||(n=i,e=!0)}t=s}}if(tt=0,Z--,e)throw n}}function M(n){if(Z>0)return n();Z++;try{return n()}finally{Fe()}}var T=void 0,ye=void 0,Z=0,tt=0,Ue=0;function dn(n){if(T!==void 0){var e=n.n;if(e===void 0||e.t!==T)return e={i:0,S:n,p:T.s,n:void 0,t:T,e:void 0,x:void 0,r:e},T.s!==void 0&&(T.s.n=e),T.s=e,n.n=e,32&T.f&&n.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=T.s,e.n=void 0,T.s.n=e,T.s=e),e}}function U(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}U.prototype.brand=Ys;U.prototype.h=function(){return!0};U.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)};U.prototype.U=function(n){if(this.t!==void 0){var e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t)}};U.prototype.subscribe=function(n){var e=this;return W(function(){var t=e.value,s=T;T=void 0;try{n(t)}finally{T=s}})};U.prototype.valueOf=function(){return this.value};U.prototype.toString=function(){return this.value+""};U.prototype.toJSON=function(){return this.value};U.prototype.peek=function(){var n=T;T=void 0;try{return this.value}finally{T=n}};Object.defineProperty(U.prototype,"value",{get:function(){var n=dn(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(tt>100)throw new Error("Cycle detected");this.v=n,this.i++,Ue++,Z++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Fe()}}}});function c(n){return new U(n)}function gn(n){for(var e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function hn(n){for(var e=n.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function fn(n){for(var e=n.s,t=void 0;e!==void 0;){var s=e.p;e.i===-1?(e.S.U(e),s!==void 0&&(s.n=e.n),e.n!==void 0&&(e.n.p=s)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=s}n.s=t}function Ie(n){U.call(this,void 0),this.x=n,this.s=void 0,this.g=Ue-1,this.f=4}(Ie.prototype=new U).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Ue))return!0;if(this.g=Ue,this.f|=1,this.i>0&&!gn(this))return this.f&=-2,!0;var n=T;try{hn(this),T=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return T=n,fn(this),this.f&=-2,!0};Ie.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}U.prototype.S.call(this,n)};Ie.prototype.U=function(n){if(this.t!==void 0&&(U.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};Ie.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}};Object.defineProperty(Ie.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=dn(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function pn(n){var e=n.u;if(n.u=void 0,typeof e=="function"){Z++;var t=T;T=void 0;try{e()}catch(s){throw n.f&=-2,n.f|=8,ft(n),s}finally{T=t,Fe()}}}function ft(n){for(var e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,pn(n)}function Xs(n){if(T!==this)throw new Error("Out-of-order effect");fn(this),T=n,this.f&=-2,8&this.f&&ft(this),Fe()}function Te(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Te.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}};Te.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,pn(this),hn(this),Z++;var n=T;return T=this,Xs.bind(this,n)};Te.prototype.N=function(){2&this.f||(this.f|=2,this.o=ye,ye=this)};Te.prototype.d=function(){this.f|=8,1&this.f||ft(this)};function W(n){var e=new Te(n);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}class vn{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){return this.items.length===0?null:this.items.shift()}isEmpty(){return this.items.length===0}size(){return this.items.length}clear(){this.items=[]}}const Oe={LOG:0,INFO:1,DEBUG:2,WARN:3,ERROR:4,NONE:5},kt="ERROR",qs="RS SDK",Js="font-weight: bold; background: black; color: white;",Zs="font-weight: normal;";class ei{constructor(e=kt,t="",s=console){this.minLogLevel=Oe[e],this.scope=t,this.logProvider=s}log(...e){this.outputLog("LOG",e)}info(...e){this.outputLog("INFO",e)}debug(...e){this.outputLog("DEBUG",e)}warn(...e){this.outputLog("WARN",e)}error(...e){this.outputLog("ERROR",e)}outputLog(e,t){var s,i;this.minLogLevel<=Oe[e]&&((i=(s=this.logProvider)[e.toLowerCase()])==null||i.call(s,...this.formatLogData(t)))}setScope(e){this.scope=e||this.scope}setMinLogLevel(e){this.minLogLevel=Oe[e],D(this.minLogLevel)&&(this.minLogLevel=Oe[kt])}formatLogData(e){if(Array.isArray(e)&&e.length>0){let t=`%c ${qs}`;this.scope&&(t=`${t} - ${this.scope}`);const s=C(e[0])?e[0].trim():"";t=`${t} %c ${s}`;const i=[t,Js,Zs];return C(e[0])||i.push(e[0]),i.push(...e.slice(1)),i}return e}}const j=new ei,En=["localStorage","memoryStorage","cookieStorage","sessionStorage","none"],nt="cookieStorage",ti='"getSourceConfig" must be a function. Please make sure that it is defined and returns a valid source configuration object.',Ct="Unable to process/parse source configuration response.",ni="The source is disabled. Please enable the source in the dashboard to send events.",si="Failed to prepare data for the request.",ii="Failed to generate the event object.",ri="Failed to invoke plugin because the extension point name is missing.",oi="Failed to invoke plugin because the extension point name is invalid.",ai=n=>`Failed to load the SDK as the base URL for ${n} is not valid.`,li=(n,e,t)=>`${n}${E}The consent manager "${e}" is not supported. Please choose one of the following supported consent managers: "${Object.keys(t)}".`,ui=n=>`${n}${E}Failed to initialize the error reporting plugin.`,ci=n=>`${n}${E}Failed to notify the error.`,di=n=>`${n}${E}Plugin name is missing.`,gi=(n,e)=>`${n}${E}Plugin "${e}" already exists.`,hi=(n,e)=>`${n}${E}Plugin "${e}" not found.`,fi=(n,e)=>`${n}${E}Plugin "${e}" not found in plugins but found in byName. This indicates a bug in the plugin engine. Please report this issue to the development team.`,pi=(n,e,t)=>`${n}${E}Plugin "${e}" could not be loaded because some of its dependencies "${t}" do not exist.`,vi=(n,e,t)=>`${n}${E}Failed to invoke the "${e}" extension point of plugin "${t}".`,Ei=(n,e)=>`${n}${E}The "${e}" storage type is `,yi=n=>`Failed to fetch the source config. Reason: ${n}`,mi=n=>`The write key "${n}" is invalid. It must be a non-empty string. Please check that the write key is correct and try again.`,Si=n=>`The data plane URL "${n}" is invalid. It must be a valid URL string. Please check that the data plane URL is correct and try again.`,bi=n=>`${n}${E}The callback is not a function.`,Ri=(n,e,t,s)=>`${n} with status: ${e}, ${t} for URL: ${s}.`,Ii=(n,e,t)=>`${n} due to timeout or no connection (${e?e.type:""}) for URL: ${t}.`,Ti=(n,e)=>`${n} for URL: ${e}`,Ai=n=>`Failed to save the value for "${n}" to storage`,_i=n=>`Failed to retrieve or parse data for "${n}" from storage`,Oi=n=>`The server responded with status ${n} while setting the cookies. As a fallback, the cookies will be set client side.`,Pi=n=>`The server failed to set the ${n} cookie. As a fallback, the cookies will be set client side.`,Ni="Failed to set/remove cookies via server. As a fallback, the cookies will be managed client side.",ki=(n,e,t)=>`${n}${E}The storage type "${e}" is not supported. Please choose one of the following supported types: "${En}". The default type "${t}" will be used instead.`,Ci=(n,e,t,s)=>`${n}${E}The error reporting provider "${e}" is not supported. Please choose one of the following supported providers: "${Object.keys(t)}". The default provider "${s}" will be used instead.`,Di=(n,e,t,s)=>`${n}${E}The storage encryption version "${e}" is not supported. Please choose one of the following supported versions: "${Object.keys(t)}". The default version "${s}" will be used instead.`,Li=(n,e,t)=>`${n}${E}The storage data migration has been disabled because the configured storage encryption version (${e}) is not the latest (${t}). To enable storage data migration, please update the storage encryption version to the latest version.`,wi=(n,e,t,s)=>`${n}${E}The "${e}" property defined under "${t}" is a reserved keyword. Please choose a different property name to avoid conflicts with reserved keywords (${s}).`,Mi=n=>`${n}${E}The Beacon API is not supported by your browser. The events will be sent using XHR instead.`,Ui=(n,e,t)=>`${n}${E}The session timeout value "${e}" is not a number. The default timeout of ${t} ms will be used instead.`,$i=n=>`${n}${E}The session timeout value is 0, which disables the automatic session tracking feature. If you want to enable session tracking, please provide a positive integer value for the timeout.`,Bi=(n,e,t)=>`${n}${E}The session timeout value ${e} ms is less than the recommended minimum of ${t} ms. Please consider increasing the timeout value to ensure optimal performance and reliability.`,Gi=(n,e,t)=>`${n}${E}The provided session ID (${e}) is either invalid, not a positive integer, or not at least "${t}" digits long. A new session ID will be auto-generated instead.`,Fi=n=>`${n}${E}The storage is either full or unavailable, so the data will not be persisted. Switching to in-memory storage.`,xi=(n,e,t,s)=>`${n}${E}The storage type "${t}" is not available for entry "${e}". The SDK will initialize the entry with "${s}" storage type instead.`,Hi=(n,e)=>`${n}${E}The write key "${e}" is not a string. Please check that the write key is correct and try again.`,ji=n=>`${n}${E}The group() method must be called with at least one argument.`,Dt="Failed to invoke the ready callback",Vi="API Callback Invocation Failed",Ki="NativeDestinationQueuePlugin initialization failed",Qi="XhrQueuePlugin initialization failed",zi="DeviceModeTransformationPlugin initialization failed",Wi="NativeDestinationQueuePlugin event enqueue failed",Yi="XhrQueuePlugin event enqueue failed",Xi=(n,e)=>`${n}${E}The provided source config URL "${e}" is invalid. Using the default source config URL instead.`,qi=(n,e)=>`Failed to load the polyfill script with ID "${n}" from URL ${e}.`,Ji=(n,e,t)=>`${n}${E}The pre-consent storage strategy "${e}" is not supported. Please choose one of the following supported strategies: "none, session, anonymousId". The default strategy "${t}" will be used instead.`,Zi=(n,e,t)=>`${n}${E}The pre-consent events delivery type "${e}" is not supported. Please choose one of the following supported types: "immediate, buffer". The default type "${t}" will be used instead.`,er=(n,e,t,s)=>{const i=t.length===1,r=i?` '${t[0]}' plugin was`:` ['${t.join("', '")}'] plugins were`,a=`${n}${E}${e}, but${r} not configured to load.`;return s?`${a} So, ${i?"the plugin":"those plugins"} will be loaded automatically.`:`${a} Ignore if this was intentional. Otherwise, consider adding ${i?"it":"them"} to the 'plugins' load API option.`},tr=(n,e)=>`${n}${E}The provided polyfill URL "${e}" is invalid. The default polyfill URL will be used instead.`,yn="js-integrations",mn="plugins",nr=new RegExp("^(https?:\\/\\/)(((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|localhost|((25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$"),be="modern",Sn="https://cdn.rudderlabs.com",pt="v3",bn=`${Sn}/${pt}/${be}/${yn}`,Rn=`${Sn}/${pt}/${be}/${mn}`,In="https://api.rudderstack.com",st="bugsnag",ne="v3",sr="xhr",it={oneTrust:"OneTrustConsentManager",ketch:"KetchConsentManager",custom:"CustomConsentManager"},Ne={[st]:"Bugsnag"},ke={[ne]:"StorageEncryption",legacy:"StorageEncryptionLegacy"},ir={[sr]:"XhrQueue",beacon:"BeaconQueue"},rr="rsaRequest",or={logLevel:"ERROR",configUrl:In,loadIntegration:!0,sessions:{autoTrack:!0,timeout:Se},sameSiteCookie:"Lax",polyfillIfRequired:!0,integrations:{All:!0},useBeacon:!1,beaconQueueOptions:{},destinationsQueueOptions:{},queueOptions:{},lockIntegrationsVersion:!1,lockPluginsVersion:!1,uaChTrackLevel:"none",plugins:[],useGlobalIntegrationsConfigInEvents:!1,bufferDataPlaneEventsUntilReady:!1,dataPlaneEventsBufferTimeout:Ns,storage:{encryption:{version:ne},migrate:!0},sendAdblockPageOptions:{},useServerSideCookies:!1},ar=c(b(or)),R={userId:"",userTraits:{},anonymousId:"",groupId:"",groupTraits:{},initialReferrer:"",initialReferringDomain:"",sessionInfo:{},authToken:null},lr=10,ur={autoTrack:!0,timeout:Se},cr={userId:c(R.userId),userTraits:c(R.userTraits),anonymousId:c(R.anonymousId),groupId:c(R.groupId),groupTraits:c(R.groupTraits),initialReferrer:c(R.initialReferrer),initialReferringDomain:c(R.initialReferringDomain),sessionInfo:c(R.sessionInfo),authToken:c(R.authToken)},dr={isOnline:c(!0),storage:{isLocalStorageAvailable:c(!1),isCookieStorageAvailable:c(!1),isSessionStorageAvailable:c(!1)},isBeaconAvailable:c(!1),isLegacyDOM:c(!1),isUaCHAvailable:c(!1),isCryptoAvailable:c(!1),isIE11:c(!1),isAdBlocked:c(!1)},gr={isErrorReportingEnabled:c(!1),isMetricsReportingEnabled:c(!1),errorReportingProviderPluginName:c(void 0),isErrorReportingPluginLoaded:c(!1)},hr=c(void 0),fr={activeDataplaneUrl:c(void 0),integrationsCDNPath:c(bn),pluginsCDNPath:c(Rn),sourceConfigUrl:c(void 0),status:c(void 0),initialized:c(!1),logLevel:c("ERROR"),loaded:c(!1),readyCallbacks:c([]),writeKey:c(void 0),dataPlaneUrl:c(void 0)},pr={enabled:c(!1),initialized:c(!1),data:c({}),activeConsentManagerPluginName:c(void 0),preConsent:c({enabled:!1}),postConsent:c({}),resolutionStrategy:c("and"),provider:c(void 0),metadata:c(void 0)},vr={retries:c(0),dropped:c(0),sent:c(0),queued:c(0),triggered:c(0)},Er={app:c({name:Rt,namespace:bs,version:me,installType:ln}),traits:c(null),library:c({name:Rt,version:me,snippetVersion:globalThis.RudderSnippetVersion}),userAgent:c(""),device:c(null),network:c(null),os:c({name:"",version:""}),locale:c(null),screen:c({density:0,width:0,height:0,innerWidth:0,innerHeight:0}),"ua-ch":c(void 0),timezone:c(void 0)},yr={configuredDestinations:c([]),activeDestinations:c([]),loadOnlyIntegrations:c({}),failedDestinations:c([]),loadIntegration:c(!0),initializedDestinations:c([]),clientDestinationsReady:c(!1),integrationsConfig:c({})},mr={toBeProcessedArray:c([]),readyCallbacksArray:c([])},Sr={ready:c(!1),loadedPlugins:c([]),failedPlugins:c([]),pluginsToLoadFromConfig:c([]),activePlugins:c([]),totalPluginsToLoad:c(0)},br={encryptionPluginName:c(void 0),migrate:c(!1),type:c(void 0),cookie:c(void 0),entries:c({}),trulyAnonymousTracking:c(!1)},Rr={isEnabledServerSideCookies:c(!1),dataServiceUrl:c(void 0)},Ir={eventsQueuePluginName:c(void 0),deliveryEnabled:c(!0)},Tr={capabilities:dr,consents:pr,context:Er,eventBuffer:mr,lifecycle:fr,loadOptions:ar,metrics:vr,nativeDestinations:yr,plugins:Sr,reporting:gr,session:cr,source:hr,storage:br,serverCookies:Rr,dataPlaneEvents:Ir},o={...b(Tr)};class Ar{constructor(e={},t){S(this,"plugins",[]);S(this,"byName",{});S(this,"cache",{});S(this,"config",{throws:!0});this.config={throws:!0,...e},this.logger=t}register(e,t){var i,r;if(!e.name){const a=di(re);if(this.config.throws)throw new Error(a);(i=this.logger)==null||i.error(a,e)}if(this.byName[e.name]){const a=gi(re,e.name);if(this.config.throws)throw new Error(a);(r=this.logger)==null||r.error(a)}this.cache={},this.plugins=this.plugins.slice();let s=this.plugins.length;this.plugins.forEach((a,l)=>{var u;(u=a.deps)!=null&&u.includes(e.name)&&(s=Math.min(s,l))}),this.plugins.splice(s,0,e),this.byName[e.name]=e,g(e.initialize)&&e.initialize(t)}unregister(e){var i,r;const t=this.byName[e];if(!t){const a=hi(re,e);if(this.config.throws)throw new Error(a);(i=this.logger)==null||i.error(a)}const s=this.plugins.indexOf(t);if(s===-1){const a=fi(re,e);if(this.config.throws)throw new Error(a);(r=this.logger)==null||r.error(a)}this.cache={},delete this.byName[e],this.plugins=this.plugins.slice(),this.plugins.splice(s,1)}getPlugin(e){return this.byName[e]}getPlugins(e){const t=e??".";return this.cache[t]||(this.cache[t]=this.plugins.filter(s=>{var i,r;if((i=s.deps)!=null&&i.some(a=>!this.byName[a])){const a=s.deps.filter(l=>!this.byName[l]);return(r=this.logger)==null||r.error(pi(re,s.name,a)),!1}return t==="."?!0:ds(s,t)})),this.cache[t]}processRawPlugins(e){e(this.plugins),this.cache={}}invoke(e,t=!0,...s){let i=e;if(!i)throw new Error(ri);const r=i.startsWith("!"),a=this.config.throws??i.endsWith("!");if(i=i.replace(/(^!|!$)/g,""),!i)throw new Error(oi);const l=i.split(".");l.pop();const u=l.join(".");return(t?this.getPlugins(i):[this.getPlugins(i)[0]]).map(f=>{var O;const y=Je(f,i);if(!g(y)||r)return y;try{return y.apply(Je(f,u),s)}catch(h){if(a)throw h;(O=this.logger)==null||O.error(vi(re,i,f.name),h)}return null})}invokeSingle(e,...t){return this.invoke(e,!1,...t)[0]}invokeMultiple(e,...t){return this.invoke(e,!0,...t)}}const Tn=new Ar({throws:!0},j),Ce="The request failed",_r=[Ce],Or="RS_JS_SDK",Pr=n=>{let e;try{if(C(n))e=n;else if(n instanceof Error)e=n.message;else if(n instanceof ErrorEvent)e=n.message;else if(n instanceof Event){const t=n.target;if(t&&t.localName!=="script"||t!=null&&t.dataset&&(t.dataset.loader!==Or||t.dataset.isnonnativesdk!=="true"))return"";e=`Error in loading a third-party script from URL ${t==null?void 0:t.src} with ID ${t==null?void 0:t.id}.`}else e=n.message?n.message:q(n)}catch(t){e=`Unknown error: ${t.message}`}return e},Nr=n=>n.message?!_r.some(e=>n.message.includes(e)):!0;class kr{constructor(e,t){this.logger=e,this.pluginEngine=t,this.errorBuffer=new vn,this.attachEffect()}attachEffect(){if(o.reporting.isErrorReportingPluginLoaded.value===!0)for(;this.errorBuffer.size()>0;)this.errorBuffer.dequeue()}attachErrorListeners(){var e;"addEventListener"in globalThis?(globalThis.addEventListener("error",t=>{this.onError(t,void 0,void 0,void 0,"unhandledException")}),globalThis.addEventListener("unhandledrejection",t=>{this.onError(t,void 0,void 0,void 0,"unhandledPromiseRejection")})):(e=this.logger)==null||e.debug("Failed to attach global error listeners.")}init(e){if(this.pluginEngine)try{const t="errorReporting.init",s=this.pluginEngine.invokeSingle(t,o,this.pluginEngine,e,this.logger);s instanceof Promise&&s.then(i=>{this.errReportingClient=i}).catch(i=>{var r;(r=this.logger)==null||r.error(ui(_e),i)})}catch(t){this.onError(t,_e)}}onError(e,t="",s="",i=!1,r="handled"){let a=Pr(e);if(!a)return;a=fs(`${t}${E}${s} ${a}`);let l=new Error(a);if(tn(e)&&(l=Object.create(e,{message:{value:a}})),r==="handled")if(this.notifyError(l),this.logger){if(this.logger.error(a),i)throw l}else throw l;o.reporting.isErrorReportingEnabled.value&&o.reporting.isErrorReportingPluginLoaded.value}leaveBreadcrumb(e){if(this.pluginEngine)try{this.pluginEngine.invokeSingle("errorReporting.breadcrumb",this.pluginEngine,this.errReportingClient,e,this.logger)}catch(t){this.onError(t,_e,"errorReporting.breadcrumb")}}notifyError(e){var t,s;if(this.errReportingClient&&Nr(e))try{(t=this.pluginEngine)==null||t.invokeSingle("errorReporting.notify",this.pluginEngine,this.errReportingClient,e,o,this.logger)}catch(i){(s=this.logger)==null||s.error(ci(_e),i)}}}const xe=new kr(j,Tn),Cr=n=>n.config.connectionMode!=="cloud"||n.config.useNativeSDKToSend===!0||n.config.useNativeSDK===!0,Dr=n=>n.config.connectionMode==="hybrid"||n.config.useNativeSDKToSend===!0,Lt=n=>n.filter(Cr),An=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],Lr={rudderAnalyticsRemotePlugins:{url:()=>Promise.resolve(window.RudderStackGlobals&&window.RudderStackGlobals.app&&window.RudderStackGlobals.app.pluginsCDNPath?""+window.RudderStackGlobals.app.pluginsCDNPath+"/rsa-plugins.js":"https://cdn.rudderlabs.com/v3/modern/plugins/rsa-plugins.js"),format:"esm",from:"vite"}},wr=async(n,e)=>{const t=typeof n=="function"?await n():n,s=document.createElement("script");s.type="text/javascript",s.onload=e,s.src=t,document.getElementsByTagName("head")[0].appendChild(s)};function _n(n,e){const t=Object.assign(n,e);for(const s of Object.keys(t))typeof t[s]=="object"&&typeof e[s]=="object"&&(t[s]=_n(t[s],e[s]));return t}const wt=n=>_n({},(globalThis.__federation_shared__||{}).default||{});async function Mr(n){const e=Lr[n];if(e.inited)return e.lib;if(e.format==="var")return new Promise(t=>{const s=()=>{e.inited||(e.lib=window[n],e.lib.init(wt(e.from)),e.inited=!0),t(e.lib)};return wr(e.url,s)});if(["esm","systemjs"].includes(e.format))return new Promise((t,s)=>{(typeof e.url=="function"?e.url:()=>Promise.resolve(e.url))().then(r=>{qn(()=>import(r),[]).then(a=>{if(!e.inited){const l=wt(e.from);a.init(l),e.lib=a,e.lib.init(l),e.inited=!0}t(e.lib)}).catch(s)})})}function L(n,e){if(!(n!=null&&n.default)&&e){let t=Object.create(null);return t.default=n,t.__esModule=!0,t}return n}function w(n,e){return Mr(n).then(t=>t.get(e).then(s=>s()))}const Ur=n=>{switch(n){case"BeaconQueue":return()=>w("rudderAnalyticsRemotePlugins","./BeaconQueue").then(e=>L(e,!0));case"Bugsnag":return()=>w("rudderAnalyticsRemotePlugins","./Bugsnag").then(e=>L(e,!0));case"CustomConsentManager":return()=>w("rudderAnalyticsRemotePlugins","./CustomConsentManager").then(e=>L(e,!0));case"DeviceModeDestinations":return()=>w("rudderAnalyticsRemotePlugins","./DeviceModeDestinations").then(e=>L(e,!0));case"DeviceModeTransformation":return()=>w("rudderAnalyticsRemotePlugins","./DeviceModeTransformation").then(e=>L(e,!0));case"ErrorReporting":return()=>w("rudderAnalyticsRemotePlugins","./ErrorReporting").then(e=>L(e,!0));case"ExternalAnonymousId":return()=>w("rudderAnalyticsRemotePlugins","./ExternalAnonymousId").then(e=>L(e,!0));case"GoogleLinker":return()=>w("rudderAnalyticsRemotePlugins","./GoogleLinker").then(e=>L(e,!0));case"KetchConsentManager":return()=>w("rudderAnalyticsRemotePlugins","./KetchConsentManager").then(e=>L(e,!0));case"NativeDestinationQueue":return()=>w("rudderAnalyticsRemotePlugins","./NativeDestinationQueue").then(e=>L(e,!0));case"OneTrustConsentManager":return()=>w("rudderAnalyticsRemotePlugins","./OneTrustConsentManager").then(e=>L(e,!0));case"StorageEncryption":return()=>w("rudderAnalyticsRemotePlugins","./StorageEncryption").then(e=>L(e,!0));case"StorageEncryptionLegacy":return()=>w("rudderAnalyticsRemotePlugins","./StorageEncryptionLegacy").then(e=>L(e,!0));case"StorageMigrator":return()=>w("rudderAnalyticsRemotePlugins","./StorageMigrator").then(e=>L(e,!0));case"XhrQueue":return()=>w("rudderAnalyticsRemotePlugins","./XhrQueue").then(e=>L(e,!0));default:return}},Ke=n=>{const e={};return n.forEach(t=>{if(An.includes(t)){const s=Ur(t);s&&(e[t]=s)}}),e},rt=()=>({}),$r=()=>({}),Br=n=>(Ke==null?void 0:Ke(n))||{},Qe={...rt(),...$r()},Gr=n=>({...Br(n)});class Fr{constructor(e,t,s){this.engine=e,this.errorHandler=t,this.logger=s,this.onError=this.onError.bind(this)}init(){o.lifecycle.status.value="pluginsLoading",Ge("pluginsCDNPath",o.lifecycle.pluginsCDNPath.value),this.setActivePlugins(),this.registerLocalPlugins(),this.registerRemotePlugins(),this.attachEffects()}attachEffects(){W(()=>{(o.plugins.activePlugins.value.length===0||o.plugins.loadedPlugins.value.length+o.plugins.failedPlugins.value.length===o.plugins.totalPluginsToLoad.value)&&M(()=>{o.plugins.ready.value=!0,o.lifecycle.status.value="pluginsReady"})})}getPluginsToLoadBasedOnConfig(){let e=o.plugins.pluginsToLoadFromConfig.value;if(!e)return[];const t=[{configurationStatus:()=>A(o.dataPlaneEvents.eventsQueuePluginName.value),configurationStatusStr:"Data plane events delivery is enabled",activePluginName:o.dataPlaneEvents.eventsQueuePluginName.value,supportedPlugins:Object.values(ir),shouldAddMissingPlugins:!0},{configurationStatus:()=>A(o.reporting.errorReportingProviderPluginName.value),configurationStatusStr:"Error reporting is enabled",activePluginName:o.reporting.errorReportingProviderPluginName.value,basePlugins:["ErrorReporting"],supportedPlugins:Object.values(Ne)},{configurationStatus:()=>Lt(o.nativeDestinations.configuredDestinations.value).length>0,configurationStatusStr:"Device mode destinations are connected to the source",supportedPlugins:["DeviceModeDestinations","NativeDestinationQueue"]},{configurationStatus:()=>Lt(o.nativeDestinations.configuredDestinations.value).some(i=>i.shouldApplyDeviceModeTransformation),configurationStatusStr:"Device mode transformations are enabled for at least one destination",supportedPlugins:["DeviceModeTransformation"]},{configurationStatus:()=>A(o.consents.activeConsentManagerPluginName.value),configurationStatusStr:"Consent management is enabled",activePluginName:o.consents.activeConsentManagerPluginName.value,supportedPlugins:Object.values(it)},{configurationStatus:()=>A(o.storage.encryptionPluginName.value),configurationStatusStr:"Storage encryption is enabled",activePluginName:o.storage.encryptionPluginName.value,supportedPlugins:Object.values(ke)},{configurationStatus:()=>o.storage.migrate.value,configurationStatusStr:"Storage migration is enabled",supportedPlugins:["StorageMigrator"]}],s=!1;return t.forEach(i=>{i.configurationStatus()?(e=e.filter(i.activePluginName?r=>!(r!==i.activePluginName&&i.supportedPlugins.includes(r)):r=>A(r)),this.addMissingPlugins(i,s,e)):e=e.filter(i.basePlugins!==void 0?r=>!(i.basePlugins.includes(r)||i.supportedPlugins.includes(r)):r=>!i.supportedPlugins.includes(r))}),[...Object.keys(rt()),...e]}addMissingPlugins(e,t,s){var l;const i=e.shouldAddMissingPlugins||t;let r;e.activePluginName?r=[...e.basePlugins||[],e.activePluginName]:r=[...e.supportedPlugins];const a=r.filter(u=>!s.includes(u));a.length>0&&(i&&s.push(...a),(l=this.logger)==null||l.warn(er(mt,e.configurationStatusStr,a,i)))}setActivePlugins(){const e=this.getPluginsToLoadBasedOnConfig(),t=[...Object.keys(Qe),...An],s=[],i=[];e.forEach(r=>{t.includes(r)?s.push(r):i.push(r)}),i.length>0&&this.onError(new Error(`Ignoring loading of unknown plugins: ${i.join(",")}. Mandatory plugins: ${Object.keys(rt()).join(",")}. Load option plugins: ${o.plugins.pluginsToLoadFromConfig.value.join(",")}`)),M(()=>{o.plugins.totalPluginsToLoad.value=e.length,o.plugins.activePlugins.value=s,o.plugins.failedPlugins.value=i})}registerLocalPlugins(){Object.values(Qe).forEach(e=>{g(e)&&o.plugins.activePlugins.value.includes(e().name)&&this.register([e()])})}registerRemotePlugins(){const e=Gr(o.plugins.activePlugins.value);Promise.all(Object.keys(e).map(async t=>{await e[t]().then(s=>this.register([s.default()])).catch(s=>{o.plugins.failedPlugins.value=[...o.plugins.failedPlugins.value,t],this.onError(s,t)})})).catch(t=>{this.onError(t)})}invokeMultiple(e,...t){try{return this.engine.invokeMultiple(e,...t)}catch(s){return this.onError(s,e),[]}}invokeSingle(e,...t){try{return this.engine.invokeSingle(e,...t)}catch(s){return this.onError(s,e),null}}register(e){e.forEach(t=>{try{this.engine.register(t,o)}catch(s){o.plugins.failedPlugins.value=[...o.plugins.failedPlugins.value,t.name],this.onError(s)}})}unregisterLocalPlugins(){Object.values(Qe).forEach(e=>{try{this.engine.unregister(e().name)}catch(t){this.onError(t)}})}onError(e,t){if(this.errorHandler)this.errorHandler.onError(e,mt,t);else throw e}}const Mt=(n,e)=>{try{return JSON.parse(n||"")}catch(t){const s=Re(t,"Failed to parse response data");if(g(e))e(s);else throw s}},xr={headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},method:"GET"},Ut=(n,e,t)=>{const s=N(xr,e||{});return t&&(s.headers=N(s.headers,{Authorization:t})),s.url=n,s},$t=(n,e=Os,t)=>new Promise((s,i)=>{let r;if(n.sendRawData===!0)r=n.data;else if(r=q(n.data,!1,[],t),x(r)){i({error:new Error(si),undefined:void 0,options:n});return}const a=new XMLHttpRequest,l=d=>{i({error:new Error(Ri(Ce,a.status,a.statusText,n.url)),xhr:a,options:n})},u=d=>{i({error:new Error(Ii(Ce,d,n.url)),xhr:a,options:n})};a.ontimeout=u,a.onerror=u,a.onload=()=>{a.status>=200&&a.status<400?s({response:a.responseText,xhr:a,options:n}):l()},a.open(n.method,n.url),n.withCredentials===!0&&(a.withCredentials=!0),a.timeout=e,Object.keys(n.headers).forEach(d=>{n.headers[d]&&a.setRequestHeader(d,n.headers[d])});try{a.send(r)}catch(d){i({error:Re(d,Ti(Ce,n.url)),xhr:a,options:n})}});class vt{constructor(e,t){S(this,"hasErrorHandler",!1);this.errorHandler=e,this.logger=t,this.hasErrorHandler=!!this.errorHandler,this.onError=this.onError.bind(this)}async getData(e){const{url:t,options:s,timeout:i,isRawResponse:r}=e;try{const a=await $t(Ut(t,s,this.basicAuthHeader),i,this.logger);return{data:r?a.response:Mt(a.response,this.onError),details:a}}catch(a){return this.onError(a.error??a),{data:void 0,details:a}}}getAsyncData(e){const{callback:t,url:s,options:i,timeout:r,isRawResponse:a}=e,l=!g(t);$t(Ut(s,i,this.basicAuthHeader),r,this.logger).then(u=>{l||t(a?u.response:Mt(u.response,this.onError),u)}).catch(u=>{this.onError(u.error??u),l||t(void 0,u)})}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,Ss);else throw e}setAuthHeader(e,t=!1){const s=t?e:vs(`${e}:`);this.basicAuthHeader=`Basic ${s}`}resetAuthHeader(){this.basicAuthHeader=void 0}}const Hr=new vt(xe,j),B="cookieStorage",$="localStorage",F="sessionStorage",V="memoryStorage",ie="none",jr="rl_user_id",Vr="rl_trait",Kr="rl_anonymous_id",Qr="rl_group_id",zr="rl_group_trait",Wr="rl_page_init_referrer",Yr="rl_page_init_referring_domain",Xr="rl_session",qr="rl_auth_token",oe={userId:jr,userTraits:Vr,anonymousId:Kr,groupId:Qr,groupTraits:zr,initialReferrer:Wr,initialReferringDomain:Yr,sessionInfo:Xr,authToken:qr},Jr="test_rudder_cookie",Zr="test_rudder_ls",eo="test_rudder_ss",to="__tld__",On="clientDataInCookie",Pn="clientDataInLocalStorage",no="clientDataInMemory",Nn="clientDataInSessionStorage",kn=["userId","userTraits","anonymousId","groupId","groupTraits","initialReferrer","initialReferringDomain","sessionInfo","authToken"],ae={[B]:On,[$]:Pn,[V]:no,[F]:Nn},so="Failed to encode the cookie data.",Bt=(n,e)=>{try{return encodeURIComponent(n)}catch(t){e==null||e.error(so,t);return}},Gt=n=>{try{return decodeURIComponent(n)}catch{return}},io=n=>{const e={},t=n.split(/\s*;\s*/);let s;return t[0]&&t.forEach(i=>{s=i.split("=");const r=s[0]?Gt(s[0]):void 0;r&&(e[r]=s[1]?Gt(s[1]):void 0)}),e},ro=(n,e,t,s)=>{const i={...t||{}};let r=`${Bt(n,s)}=${Bt(e,s)}`;x(e)&&(i.maxage=-1),i.maxage&&(i.expires=new Date(+new Date+i.maxage)),i.path&&(r+=`; path=${i.path}`),i.domain&&(r+=`; domain=${i.domain}`),i.expires&&(r+=`; expires=${i.expires.toUTCString()}`),i.samesite&&(r+=`; samesite=${i.samesite}`),i.secure&&(r+="; secure"),globalThis.document.cookie=r},ot=()=>{const n=globalThis.document.cookie;return io(n)},oo=n=>ot()[n],X=function(n,e,t,s){switch(arguments.length){case 4:case 3:case 2:return ro(n,e,t,s);case 1:return n?oo(n):ot();default:return ot()}},ao=(n,e)=>{const t=new URL(o.lifecycle.sourceConfigUrl.value),s=`${t.origin}${t.pathname}?view=ad`,i=new vt(n,e);i.setAuthHeader(o.lifecycle.writeKey.value),i.getAsyncData({url:s,options:{method:"HEAD",headers:{"Content-Type":void 0}},isRawResponse:!0,callback:(r,a)=>{var l;o.capabilities.isAdBlocked.value=(a==null?void 0:a.error)!==void 0||((l=a==null?void 0:a.xhr)==null?void 0:l.responseURL)!==s}})},lo=()=>!H(globalThis.crypto)&&g(globalThis.crypto.getRandomValues),Ft=()=>!H(globalThis.navigator.userAgentData),uo=()=>!H(globalThis.navigator.sendBeacon)&&g(globalThis.navigator.sendBeacon),co=()=>!!globalThis.navigator.userAgent.match(/Trident.*rv:11\./),go=(n,e="none")=>{var t;e==="none"&&n(void 0),e==="default"&&n(navigator.userAgentData),e==="full"&&((t=navigator.userAgentData)==null||t.getHighEntropyValues(["architecture","bitness","brands","mobile","model","platform","platformVersion","uaFullVersion","fullVersionList","wow64"]).then(s=>{n(s)}).catch(()=>{n()}))},ho=()=>{const n=globalThis.document.createElement("div");return n.setAttribute("data-a-b","c"),n.dataset?n.dataset.aB==="c":!1},at={URL:()=>!g(globalThis.URL)||!g(globalThis.URLSearchParams),Promise:()=>!g(globalThis.Promise),"Number.isNaN":()=>!g(globalThis.Number.isNaN),"Number.isInteger":()=>!g(globalThis.Number.isInteger),"Array.from":()=>!g(globalThis.Array.from),"Array.prototype.find":()=>!g(globalThis.Array.prototype.find),"Array.prototype.includes":()=>!g(globalThis.Array.prototype.includes),"String.prototype.endsWith":()=>!g(globalThis.String.prototype.endsWith),"String.prototype.startsWith":()=>!g(globalThis.String.prototype.startsWith),"String.prototype.includes":()=>!g(globalThis.String.prototype.includes),"String.prototype.replaceAll":()=>!g(globalThis.String.prototype.replaceAll),"String.fromCodePoint":()=>!g(globalThis.String.fromCodePoint),"Object.entries":()=>!g(globalThis.Object.entries),"Object.values":()=>!g(globalThis.Object.values),"Object.assign":()=>!g(globalThis.Object.assign),"Object.fromEntries":()=>!g(globalThis.Object.fromEntries),"Element.prototype.dataset":()=>!ho(),TextEncoder:()=>!g(globalThis.TextEncoder)||!g(globalThis.TextDecoder),requestAnimationFrame:()=>!g(globalThis.requestAnimationFrame)||!g(globalThis.cancelAnimationFrame),CustomEvent:()=>!g(globalThis.CustomEvent),"navigator.sendBeacon":()=>!g(globalThis.navigator.sendBeacon),ArrayBuffer:()=>!g(globalThis.Uint8Array),Set:()=>!g(globalThis.Set),atob:()=>!g(globalThis.atob)},fo=()=>{const n=Object.keys(at);let e=!1;for(let t=0;t<n.length;t++){const s=at[n[t]];if(g(s)&&s()){e=!0;break}}return e},xt=()=>{let n={density:0,width:0,height:0,innerWidth:0,innerHeight:0};return n={width:globalThis.screen.width,height:globalThis.screen.height,density:globalThis.devicePixelRatio,innerWidth:globalThis.innerWidth,innerHeight:globalThis.innerHeight},n},Cn=n=>{const e=["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"],t=[22,1014],s=e.includes(n.name)||t.includes(n.code);return n instanceof DOMException&&s},ce=(n=$,e,t)=>{let s,i;try{switch(n){case V:return!0;case B:s=e,i=Jr;break;case $:s=e??globalThis.localStorage,i=Zr;break;case F:s=e??globalThis.sessionStorage,i=eo;break;default:return!1}return s?(s.setItem(i,"true"),s.getItem(i)?(s.removeItem(i),!0):!1):!1}catch(r){const a=Ei(Ze,n);let l="unavailable";return Cn(r)&&(l="full"),t==null||t.warn(`${a}${l}.`,r),!1}},po=n=>{const e=document.createElement("a");return e.href=n,e.hostname},vo=n=>{const e=typeof globalThis.URL!="function"?po(n):new URL(n).hostname,t=(e==null?void 0:e.split("."))??[],s=t[t.length-1],i=[];if(t.length===4&&s&&s===parseInt(s,10).toString())return i;if(t.length<=1)return t[0]&&t[0].indexOf("localhost")!==-1?["localhost"]:i;for(let r=t.length-2;r>=0;r-=1)i.push(t.slice(r).join("."));return i},Eo=n=>{const e=vo(n);for(let t=0;t<e.length;t+=1){const s=e[t],i=to,r={domain:`${s.indexOf("localhost")!==-1?"":"."}${s}`};if(X(i,1,r),X(i))return X(i,null,r),s}return""},yo=()=>{const n=`.${Eo(globalThis.location.href)}`;return{maxage:Ps,path:"/",domain:!n||n==="."?void 0:n,samesite:"Lax",enabled:!0}},mo=()=>({enabled:!0}),So=()=>({enabled:!0}),bo=()=>({enabled:!0}),le=class le{constructor(e={},t){S(this,"isSupportAvailable",!0);S(this,"isEnabled",!0);S(this,"length",0);if(le.globalSingleton)return le.globalSingleton;this.options=yo(),this.logger=t,this.configure(e),le.globalSingleton=this}configure(e){return this.options=N(this.options??{},e),e.sameDomainCookiesOnly&&delete this.options.domain,this.isSupportAvailable=ce(B,this,this.logger),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){return X(e,t,this.options,this.logger),this.length=Object.keys(X()).length,!0}getItem(e){const t=X(e);return D(t)?null:t}removeItem(e){const t=this.setItem(e,null);return this.length=Object.keys(X()).length,t}clear(){}key(e){return this.keys()[e]??null}keys(){return Object.keys(X())}};S(le,"globalSingleton",null);let $e=le;class Ro{constructor(e,t){S(this,"isEnabled",!0);S(this,"length",0);S(this,"data",{});this.options=bo(),this.logger=t,this.configure(e??{})}configure(e){return this.options=N(this.options,e),this.isEnabled=!!this.options.enabled,this.options}setItem(e,t){return this.data[e]=t,this.length=Object.keys(this.data).length,t}getItem(e){return e in this.data?this.data[e]:null}removeItem(e){return e in this.data&&delete this.data[e],this.length=Object.keys(this.data).length,null}clear(){this.data={},this.length=0}key(e){return this.keys()[e]??null}keys(){return Object.keys(this.data)}}const lt=new Ro({},j);var Io=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function To(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Dn={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(Io,function(){function t(h){return h=JSON.stringify(h),!!/^\{[\s\S]*\}$/.test(h)}function s(h){return h===void 0||typeof h=="function"?h+"":JSON.stringify(h)}function i(h){if(typeof h=="string")try{return JSON.parse(h)}catch{return h}}function r(h){return{}.toString.call(h)==="[object Function]"}function a(h){return Object.prototype.toString.call(h)==="[object Array]"}function l(h){var p="_Is_Incognit",I="yes";try{h||(h=window.localStorage),h.setItem(p,I),h.removeItem(p)}catch{var m={};m._data={},m.setItem=function(k,je){return m._data[k]=String(je)},m.getItem=function(k){return m._data.hasOwnProperty(k)?m._data[k]:void 0},m.removeItem=function(k){return delete m._data[k]},m.clear=function(){return m._data={}},h=m}finally{h.getItem(p)===I&&h.removeItem(p)}return h}var u=l();function d(){if(!(this instanceof d))return new d}d.prototype={set:function(p,I){if(p&&!t(p))u.setItem(p,s(I));else if(t(p))for(var m in p)this.set(m,p[m]);return this},get:function(p){if(p===void 0){var I={};return this.forEach(function(Kn,Qn){return I[Kn]=Qn}),I}if(p.charAt(0)==="?")return this.has(p.substr(1));var m=arguments;if(m.length>1){for(var P={},k=0,je=m.length;k<je;k++){var Vn=i(u.getItem(m[k]));this.has(m[k])&&(P[m[k]]=Vn)}return P}return i(u.getItem(p))},clear:function(){return u.clear(),this},remove:function(p){var I=this.get(p);return u.removeItem(p),I},has:function(p){return{}.hasOwnProperty.call(this.get(),p)},keys:function(){var p=[];return this.forEach(function(I){p.push(I)}),p},forEach:function(p){for(var I=0,m=u.length;I<m;I++){var P=u.key(I);p(P,this.get(P))}return this},search:function(p){for(var I=this.keys(),m={},P=0,k=I.length;P<k;P++)I[P].indexOf(p)>-1&&(m[I[P]]=this.get(I[P]));return m},len:function(){return u.length}};var f=null;function y(h,p){var I=arguments,m=null;if(f||(f=d()),I.length===0)return f.get();if(I.length===1){if(typeof h=="string")return f.get(h);if(t(h))return f.set(h)}if(I.length===2&&typeof h=="string"){if(!p)return f.remove(h);if(p&&typeof p=="string")return f.set(h,p);p&&r(p)&&(m=null,m=p(h,f.get(h)),y.set(h,m))}if(I.length===2&&a(h)&&r(p))for(var P=0,k=h.length;P<k;P++)m=p(h[P],f.get(h[P])),y.set(h[P],m);return y}for(var O in d.prototype)y[O]=d.prototype[O];return y})})(Dn);var Ao=Dn.exports;const ee=To(Ao);class _o{constructor(e={},t){S(this,"isSupportAvailable",!0);S(this,"isEnabled",!0);S(this,"length",0);this.options=mo(),this.logger=t,this.configure(e)}configure(e){return this.options=N(this.options,e),this.isSupportAvailable=ce($,this,this.logger),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){ee.set(e,t),this.length=ee.len()}getItem(e){const t=ee.get(e);return D(t)?null:t}removeItem(e){ee.remove(e),this.length=ee.len()}clear(){ee.clear(),this.length=0}key(e){return this.keys()[e]??null}keys(){return ee.keys()}}const Ln=new _o({},j);class Oo{constructor(e={},t){S(this,"isSupportAvailable",!0);S(this,"isEnabled",!0);S(this,"length",0);S(this,"store",globalThis.sessionStorage);this.options=So(),this.logger=t,this.configure(e)}configure(e){return this.options=N(this.options,e),this.isSupportAvailable=ce(F,this,this.logger),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){this.store.setItem(e,t),this.length=this.store.length}getItem(e){const t=this.store.getItem(e);return D(t)?null:t}removeItem(e){this.store.removeItem(e),this.length=this.store.length}clear(){this.store.clear(),this.length=0}key(e){return this.store.key(e)}keys(){const e=[];for(let t=0;t<this.store.length;t+=1){const s=this.store.key(t);s!==null&&e.push(s)}return e}}const wn=new Oo({},j),G=n=>{switch(n){case $:return Ln;case F:return wn;case V:return lt;case B:return new $e({},j);default:return lt}},Po=n=>{const e=new $e({},j).configure(n);o.storage.cookie.value={maxage:e.maxage,path:e.path,domain:e.domain,samesite:e.samesite,expires:e.expires,secure:e.secure}},No=n=>{Ln.configure(n)},ko=n=>{lt.configure(n)},Co=n=>{wn.configure(n)},Do=(n={},e={},t={},s={})=>{Po(n),No(e),ko(t),Co(s)};class Lo{constructor(e,t,s){S(this,"hasErrorHandler",!1);this.id=e.id,this.name=e.name,this.isEncrypted=e.isEncrypted??!1,this.validKeys=e.validKeys??{},this.engine=t??G($),this.noKeyValidation=Object.keys(this.validKeys).length===0,this.noCompoundKey=e.noCompoundKey,this.originalEngine=this.engine,this.errorHandler=e.errorHandler??xe,this.hasErrorHandler=!!this.errorHandler,this.logger=e.logger??j,this.pluginsManager=s}createValidKey(e){const{name:t,id:s,validKeys:i,noKeyValidation:r,noCompoundKey:a}=this;if(r)return a?e:[t,s,e].join(".");let l;return Object.values(i).forEach(u=>{u===e&&(l=a?e:[t,s,e].join("."))}),l}swapQueueStoreToInMemoryEngine(){const{name:e,id:t,validKeys:s,noCompoundKey:i}=this,r=G(V);Object.keys(s).forEach(a=>{const l=this.get(s[a]),u=i?a:[e,t,a].join(".");r.setItem(u,l),this.remove(a)}),this.engine=r}set(e,t){var i;const s=this.createValidKey(e);if(s)try{this.engine.setItem(s,this.encrypt(q(t,!1,[],this.logger)))}catch(r){Cn(r)?((i=this.logger)==null||i.warn(Fi(`Store ${this.id}`)),this.swapQueueStoreToInMemoryEngine(),this.set(e,t)):this.onError(Re(r,Ai(e)))}}get(e){const t=this.createValidKey(e);try{if(!t)return null;const s=this.decrypt(this.engine.getItem(t));return H(s)?null:JSON.parse(s)}catch(s){return this.onError(new Error(`${_i(e)}: ${s.message}`)),null}}remove(e){const t=this.createValidKey(e);t&&this.engine.removeItem(t)}getOriginalEngine(){return this.originalEngine}decrypt(e){return H(e)?null:this.crypto(e,"decrypt")}encrypt(e){return this.crypto(e,"encrypt")}crypto(e,t){if(!this.isEncrypted||!e||typeof e!="string"||hs(e)==="")return e;const i=`storage.${t}`,r=this.pluginsManager?this.pluginsManager.invokeSingle(i,e):e;return typeof r>"u"?e:r??""}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,`Store ${this.id}`);else throw e}}const wo=(n,e)=>{var s;let t;if(n.consents.preConsent.value.enabled)switch((s=n.consents.preConsent.value.storage)==null?void 0:s.strategy){case"none":t=ie;break;case"session":e!=="sessionInfo"&&(t=ie);break;case"anonymousId":e!=="anonymousId"&&(t=ie);break}return t};class Mo{constructor(e,t,s){S(this,"stores",{});S(this,"isInitialized",!1);S(this,"hasErrorHandler",!1);this.errorHandler=t,this.logger=s,this.hasErrorHandler=!!this.errorHandler,this.pluginsManager=e,this.onError=this.onError.bind(this)}init(){var s;if(this.isInitialized)return;const e=o.loadOptions.value,t={cookieStorageOptions:{samesite:e.sameSiteCookie,secure:e.secureCookie,domain:e.setCookieDomain,sameDomainCookiesOnly:e.sameDomainCookiesOnly,enabled:!0},localStorageOptions:{enabled:!0},inMemoryStorageOptions:{enabled:!0},sessionStorageOptions:{enabled:!0}};Do(pe(N(t.cookieStorageOptions??{},((s=o.storage.cookie)==null?void 0:s.value)??{})),pe(t.localStorageOptions),pe(t.inMemoryStorageOptions),pe(t.sessionStorageOptions)),this.initClientDataStores(),this.isInitialized=!0}initClientDataStores(){this.initializeStorageState(),[V,$,B,F].forEach(t=>{var s;(s=G(t))!=null&&s.isEnabled&&this.setStore({id:ae[t],name:ae[t],isEncrypted:!0,noCompoundKey:!0,type:t})})}initializeStorageState(){var a;let e=o.storage.type.value,t=(a=o.loadOptions.value.storage)==null?void 0:a.entries;const s=o.consents.postConsent.value.storage;(A(s==null?void 0:s.type)||A(s==null?void 0:s.entries))&&(e=s==null?void 0:s.type,t=s==null?void 0:s.entries);let i=!0,r={};kn.forEach(l=>{var p;const u=l,d=l,f=(p=t==null?void 0:t[u])==null?void 0:p.type,O=wo(o,l)??f??e??nt,h=this.getResolvedStorageTypeForEntry(O,l);h!==ie&&(i=!1),r={...r,[l]:{type:h,key:oe[d]}}}),M(()=>{o.storage.type.value=e,o.storage.entries.value=r,o.storage.trulyAnonymousTracking.value=i})}getResolvedStorageTypeForEntry(e,t){var i,r,a,l,u,d;let s=e;switch(e){case $:(i=G($))!=null&&i.isEnabled||(s=V);break;case F:(r=G(F))!=null&&r.isEnabled||(s=V);break;case V:case ie:break;case B:default:(a=G(B))!=null&&a.isEnabled?s=B:(l=G($))!=null&&l.isEnabled?s=$:(u=G(F))!=null&&u.isEnabled?s=F:s=V;break}return s!==e&&((d=this.logger)==null||d.warn(xi(St,t,e,s))),s}setStore(e){const t=G(e.type);return this.stores[e.id]=new Lo(e,t,this.pluginsManager),this.stores[e.id]}getStore(e){return this.stores[e]}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,St);else throw e}}const Uo=n=>n.replace(/\/{2,}/g,"/"),ge=n=>{if(!C(n))return!1;try{return g(globalThis.URL)&&new URL(n),nr.test(n)}catch{return!1}},$o=n=>{if(!C(n)||n.trim().length===0)throw new Error(mi(n))},Bo=n=>{if(!ge(n))throw new Error(Si(n))},Go=(n,e)=>{$o(n),Bo(e)},Fo=n=>v(n)&&v(n.source)&&!H(n.source.id)&&v(n.source.config)&&Array.isArray(n.source.destinations),xo=n=>typeof n=="string"&&En.includes(n),Ho=n=>{const e=new URL(n),{host:t,protocol:s}=e,i=t.split(".");let r;return i.length>2?r=`${i[i.length-2]}.${i[i.length-1]}`:r=t,`${s}//${r}`},jo=n=>{const e=Ho(window.location.href),t=n.startsWith("/")?n.substring(1):n;return`${e}/${t}`},Vo=n=>{const e=[];return n.forEach(t=>{t.enabled&&!t.deleted&&e.push({id:t.id,displayName:t.destinationDefinition.displayName,config:t.config,shouldApplyDeviceModeTransformation:t.shouldApplyDeviceModeTransformation||!1,propagateEventsUntransformedOnError:t.propagateEventsUntransformedOnError||!1,userFriendlyId:`${t.destinationDefinition.displayName.replaceAll(" ","-")}___${t.id}`})}),e},he=n=>n!=null&&n.endsWith("/")?he(n.substring(0,n.length-1)):n,ut=n=>{try{return new URL(n).host}catch{return null}},Mn=n=>ut(n)??"",Ko=n=>{const e={};try{const t=new URL(n),s="utm_";t.searchParams.forEach((i,r)=>{if(r.startsWith(s)){let a=r.substring(s.length);a==="campaign"&&(a="name"),e[a]=i}})}catch{}return e},Qo=n=>{let e=n;try{const t=new URL(n);e=t.origin+t.pathname+t.search}catch{}return e},zo=()=>!!(window.chrome&&window.chrome.runtime&&window.chrome.runtime.id),ze="none",We="immediate",Wo=n=>{var e,t;return((t=(e=n==null?void 0:n.statsCollection)==null?void 0:e.errors)==null?void 0:t.enabled)===!0},Yo=n=>{var e,t;return(t=(e=n==null?void 0:n.statsCollection)==null?void 0:e.errors)==null?void 0:t.provider},Xo=n=>{var e,t;return((t=(e=n==null?void 0:n.statsCollection)==null?void 0:e.metrics)==null?void 0:t.enabled)===!0},He={All:!0},qo=n=>{const e={sendPageEvent:!1,trackConsent:!1,discardPreConsentEvents:!1};if(v(n)){const t=b(n);e.storage=t.storage,A(t.integrations)&&(e.integrations=v(t.integrations)?t.integrations:He),e.discardPreConsentEvents=t.discardPreConsentEvents===!0,e.sendPageEvent=t.sendPageEvent===!0,e.trackConsent=t.trackConsent===!0,Be(t.consentManagement)&&(e.consentManagement=N(t.consentManagement,{enabled:o.consents.enabled.value}))}return e},Ht=n=>Be(n)||Array.isArray(n),Jo=(n,e)=>{let{provider:t}=n;const s=t?it[t]:void 0;return t&&!s&&(e==null||e.error(li(K,t,it)),t=void 0),{provider:t,consentManagerPluginName:s}},Un=(n,e)=>{let t,s=[],i=[],r=!1,a,l=(n==null?void 0:n.enabled)===!0;Be(n)&&l&&({provider:a,consentManagerPluginName:t}=Jo(n,e),Ht(n.allowedConsentIds)&&(s=n.allowedConsentIds,r=!0),Ht(n.deniedConsentIds)&&(i=n.deniedConsentIds,r=!0));const u={allowedConsentIds:s,deniedConsentIds:i};return l=l&&!!t,{provider:a,consentManagerPluginName:t,initialized:r,enabled:l,consentsData:u}},Zo=()=>{const n=document.getElementsByTagName("script"),e=/(?:^|\/)rsa(\.min)?\.js$/;for(const t of n){const s=t.getAttribute("src");if(s&&e.test(s))return s}},ea=(n,e)=>{if(o.reporting.isErrorReportingEnabled.value=Wo(n.source.config)&&!zo(),o.reporting.isMetricsReportingEnabled.value=Xo(n.source.config),o.reporting.isErrorReportingEnabled.value){const t=Yo(n.source.config),s=t?Ne[t]:void 0;!D(t)&&!s&&(e==null||e.warn(Ci(K,t,Ne,st))),o.reporting.errorReportingProviderPluginName.value=s??Ne[st]}},ta=n=>{var d;const{useServerSideCookies:e,dataServiceEndpoint:t,storage:s}=o.loadOptions.value;let i=s==null?void 0:s.type;A(i)&&!xo(i)&&(n==null||n.warn(ki(K,i,nt)),i=nt);let r=(d=s==null?void 0:s.encryption)==null?void 0:d.version;const a=r&&ke[r];!D(r)&&D(a)?(n==null||n.warn(Di(K,r,ke,ne)),r=ne):D(r)&&(r=ne);const l=s==null?void 0:s.migrate,u=l&&r===ne;l===!0&&u!==l&&(n==null||n.warn(Li(K,r,ne))),M(()=>{o.storage.type.value=i;let f=(s==null?void 0:s.cookie)??{};if(e){o.serverCookies.isEnabledServerSideCookies.value=e;const y=jo(t??rr);if(ge(y)){o.serverCookies.dataServiceUrl.value=he(y);const O=ut(window.location.href),h=ut(y);O!==h&&(f={...f,samesite:"None",secure:!0})}else o.serverCookies.isEnabledServerSideCookies.value=!1}o.storage.cookie.value=f,o.storage.encryptionPluginName.value=ke[r],o.storage.migrate.value=u})},na=n=>{var y,O,h,p;const{provider:e,consentManagerPluginName:t,initialized:s,enabled:i,consentsData:r}=Un(o.loadOptions.value.consentManagement,n),a=o.loadOptions.value.preConsent;let l=((y=a==null?void 0:a.storage)==null?void 0:y.strategy)??ze;const u=["none","session","anonymousId"];A(l)&&!u.includes(l)&&(l=ze,n==null||n.warn(Ji(K,(O=a==null?void 0:a.storage)==null?void 0:O.strategy,ze)));let d=((h=a==null?void 0:a.events)==null?void 0:h.delivery)??We;const f=["immediate","buffer"];A(d)&&!f.includes(d)&&(d=We,n==null||n.warn(Zi(K,(p=a==null?void 0:a.events)==null?void 0:p.delivery,We))),M(()=>{var I;o.consents.activeConsentManagerPluginName.value=t,o.consents.initialized.value=s,o.consents.enabled.value=i,o.consents.data.value=r,o.consents.provider.value=e,o.consents.preConsent.value={enabled:((I=o.loadOptions.value.preConsent)==null?void 0:I.enabled)===!0&&s===!1&&i===!0,storage:{strategy:l},events:{delivery:d}}})},sa=n=>{var s;let e=o.consents.resolutionStrategy.value,t;v(n.consentManagementMetadata)&&(o.consents.provider.value&&(e=((s=n.consentManagementMetadata.providers.find(i=>i.provider===o.consents.provider.value))==null?void 0:s.resolutionStrategy)??o.consents.resolutionStrategy.value),t=n.consentManagementMetadata),o.consents.provider.value==="custom"&&(e=void 0),M(()=>{o.consents.metadata.value=b(t),o.consents.resolutionStrategy.value=e})},ia=n=>{if(o.dataPlaneEvents.deliveryEnabled.value){const e="XhrQueue";let t=e;o.loadOptions.value.useBeacon&&(o.capabilities.isBeaconAvailable.value?t="BeaconQueue":(t=e,n==null||n.warn(Mi(K)))),M(()=>{o.dataPlaneEvents.eventsQueuePluginName.value=t})}},ra=(n,e,t,s,i)=>{const r=new URLSearchParams({p:ln,v:me,build:be,writeKey:e,lockIntegrationsVersion:t.toString(),lockPluginsVersion:s.toString()});let a=In,l=r,u="/sourceConfig/",d="";if(ge(n)){const f=new URL(n);he(f.pathname).endsWith("/sourceConfig")||(f.pathname=`${he(f.pathname)}/sourceConfig/`),f.pathname=Uo(f.pathname),r.forEach((y,O)=>{f.searchParams.get(O)===null&&f.searchParams.set(O,y)}),a=f.origin,u=f.pathname,l=f.searchParams,d=f.hash}else i==null||i.warn(Xi(K,n));return`${a}${u}?${l}${d}`},$n=(n,e,t,s,i,r)=>{let a="";if(r){if(!ge(r))throw new Error(ai(n));return he(r)}const l=Zo();return a=l?l.split("/").slice(0,-1).concat(e).join("/"):t,i&&(a=a.replace(`/${pt}/${be}/${e}`,`/${s}/${be}/${e}`)),a},oa=(n,e,t)=>$n("integrations",yn,bn,n,e,t),aa=(n,e,t)=>$n("plugins",mn,Rn,n,e,t);class la{constructor(e,t,s){S(this,"hasErrorHandler",!1);this.errorHandler=t,this.logger=s,this.httpClient=e,this.hasErrorHandler=!!this.errorHandler,this.onError=this.onError.bind(this),this.processConfig=this.processConfig.bind(this)}attachEffects(){W(()=>{var e;(e=this.logger)==null||e.setMinLogLevel(o.lifecycle.logLevel.value)})}init(){this.attachEffects(),Go(o.lifecycle.writeKey.value,o.lifecycle.dataPlaneUrl.value);const{logLevel:e,configUrl:t,lockIntegrationsVersion:s,lockPluginsVersion:i,destSDKBaseURL:r,pluginsSDKBaseURL:a}=o.loadOptions.value;o.lifecycle.activeDataplaneUrl.value=he(o.lifecycle.dataPlaneUrl.value);const l=oa(me,s,r),u=aa(me,i,a);ta(this.logger),na(this.logger),ia(this.logger),M(()=>{o.lifecycle.integrationsCDNPath.value=l,o.lifecycle.pluginsCDNPath.value=u,e&&(o.lifecycle.logLevel.value=e),o.lifecycle.sourceConfigUrl.value=ra(t,o.lifecycle.writeKey.value,s,i,this.logger)}),this.getConfig()}onError(e,t,s){var i;if(this.hasErrorHandler)(i=this.errorHandler)==null||i.onError(e,K,t,s);else throw e}processConfig(e,t){var r;if(!e){this.onError(yi(t==null?void 0:t.error));return}let s;try{C(e)?s=JSON.parse(e):s=e}catch(a){this.onError(a,Ct,!0);return}if(!Fo(s)){this.onError(new Error(Ct),void 0,!0);return}if(s.source.enabled===!1){(r=this.logger)==null||r.error(ni);return}ea(s,this.logger);const i=s.source.destinations.length>0?Vo(s.source.destinations):[];M(()=>{o.source.value={config:s.source.config,id:s.source.id,workspaceId:s.source.workspaceId},o.nativeDestinations.configuredDestinations.value=i,o.plugins.pluginsToLoadFromConfig.value=o.loadOptions.value.plugins??[],sa(s),o.lifecycle.status.value="configured"})}getConfig(){const e=o.loadOptions.value.getSourceConfig;if(e){if(!g(e))throw new Error(ti);const t=e();t instanceof Promise?t.then(s=>this.processConfig(s)).catch(s=>{this.onError(s,"SourceConfig")}):this.processConfig(t)}else this.httpClient.getAsyncData({url:o.lifecycle.sourceConfigUrl.value,options:{headers:{"Content-Type":void 0}},callback:this.processConfig})}}const ua=()=>{const n=new Date().toString().match(/([A-Z]+[+-]\d+)/);return n&&n[1]?n[1]:"NA"},Bn=()=>(document==null?void 0:document.referrer)||"$direct",ca=()=>{const n=document.getElementsByTagName("link");let e="";for(let t=0;n[t];t+=1){const s=n[t];if(s.getAttribute("rel")==="canonical"&&!e){e=s.getAttribute("href")??"";break}}return e},da=()=>{if(D(globalThis.navigator))return null;let{userAgent:n}=globalThis.navigator;const{brave:e}=globalThis.navigator;if(e&&Object.getPrototypeOf(e).isBrave){const t=n.match(/(chrome)\/([\w.]+)/i);t&&(n=`${n} Brave/${t[2]}`)}return n},ga=()=>D(globalThis.navigator)?null:globalThis.navigator.language??globalThis.navigator.browserLanguage,Gn=()=>{const n=ca();let e=globalThis.location.pathname;const{href:t}=globalThis.location;let s=t;const{search:i}=globalThis.location;if(n)try{const u=new URL(n);u.search===""?s=n+i:s=n,e=u.pathname}catch{}const r=Qo(s),{title:a}=document,l=Bn();return{path:e,referrer:l,referring_domain:Mn(l),search:i,title:a,url:r,tab_url:t}},ha=`https://polyfill-fastly.io/v3/polyfill.min.js?version=3.111.0&features=${Object.keys(at).join("%2C")}`,fa=10*1e3,jt="rudderstackPolyfill";class pa{constructor(e,t){this.logger=t,this.errorHandler=e,this.externalSrcLoader=new cn(this.errorHandler,this.logger),this.onError=this.onError.bind(this),this.onReady=this.onReady.bind(this)}init(){try{this.prepareBrowserCapabilities(),this.attachWindowListeners()}catch(e){this.onError(e)}}detectBrowserCapabilities(){M(()=>{o.capabilities.storage.isCookieStorageAvailable.value=ce(B,G(B),this.logger),o.capabilities.storage.isLocalStorageAvailable.value=ce($,void 0,this.logger),o.capabilities.storage.isSessionStorageAvailable.value=ce(F,void 0,this.logger),o.capabilities.isBeaconAvailable.value=uo(),o.capabilities.isUaCHAvailable.value=Ft(),o.capabilities.isCryptoAvailable.value=lo(),o.capabilities.isIE11.value=co(),o.capabilities.isOnline.value=globalThis.navigator.onLine,o.context.userAgent.value=da(),o.context.locale.value=ga(),o.context.screen.value=xt(),o.context.timezone.value=ua(),Ft()&&go(e=>{o.context["ua-ch"].value=e},o.loadOptions.value.uaChTrackLevel)}),W(()=>{o.loadOptions.value.sendAdblockPage===!0&&o.lifecycle.sourceConfigUrl.value!==void 0&&ao(this.errorHandler,this.logger)})}prepareBrowserCapabilities(){var i;o.capabilities.isLegacyDOM.value=fo();const e=o.loadOptions.value.polyfillURL;let t=ha;if(de(e)&&(ge(e)?t=e:(i=this.logger)==null||i.warn(tr(Ze,e))),o.loadOptions.value.polyfillIfRequired&&o.capabilities.isLegacyDOM.value&&ge(t)){const r=t!==o.loadOptions.value.polyfillURL;if(r){const a=`RS_polyfillCallback_${o.lifecycle.writeKey.value}`,l=()=>{this.onReady(),delete globalThis[a]};globalThis[a]=l,t=`${t}&callback=${a}`}this.externalSrcLoader.loadJSFile({url:t,id:jt,async:!0,timeout:fa,callback:a=>{a?r||this.onReady():this.onError(new Error(qi(jt,t)))}})}else this.onReady()}attachWindowListeners(){globalThis.addEventListener("offline",()=>{o.capabilities.isOnline.value=!1}),globalThis.addEventListener("online",()=>{o.capabilities.isOnline.value=!0}),globalThis.addEventListener("resize",Ds(()=>{o.context.screen.value=xt()},this))}onReady(){this.detectBrowserCapabilities(),o.lifecycle.status.value="browserCapabilitiesReady"}onError(e){if(this.errorHandler)this.errorHandler.onError(e,Ze);else throw e}}function va(n){return crypto.getRandomValues(new Uint8Array(n))}var Vt=4096,De=[],J=0,Ye;for(;J<256;J++)De[J]=(J+256).toString(16).substring(1);function Ea(){(!Ye||J+16>Vt)&&(Ye=va(Vt),J=0);for(var n=0,e,t="";n<16;n++)e=Ye[J+n],n==6?t+=De[e&15|64]:n==8?t+=De[e&63|128]:t+=De[e],n&1&&n>1&&n<11&&(t+="-");return J+=16,t}var se=256,Le=[],Pe;for(;se--;)Le[se]=(se+256).toString(16).substring(1);function ya(){var n=0,e,t="";if(!Pe||se+16>256){for(Pe=Array(n=256);n--;)Pe[n]=256*Math.random()|0;n=se=0}for(;n<16;n++)e=Pe[se+n],n==6?t+=Le[e&15|64]:n==8?t+=Le[e&63|128]:t+=Le[e],n&1&&n>1&&n<11&&(t+="-");return se++,t}const ma=()=>!H(globalThis.crypto)&&g(globalThis.crypto.getRandomValues),Fn=()=>ma()?Ea():ya(),Sa=()=>new Date().toISOString(),ba="web",Ra=["integrations","anonymousId","originalTimestamp"],Kt=["library","consentManagement","userAgent","ua-ch","screen"],Xe=["id","anonymous_id","user_id","sent_at","timestamp","received_at","original_timestamp","event","event_text","channel","context_ip","context_request_ip","context_passed_ip","group_id","previous_id"],xn=n=>typeof n=="number"&&!Number.isNaN(n),Ia=(n,e)=>e.toString().length>=n,Hn=n=>xn(n)&&n>=0&&Number.isInteger(n),Qt=10,zt=n=>{const e=Date.now();return!n||e>n},Ta=()=>Date.now(),Aa=(n,e)=>!n||!Hn(n)||!Ia(Qt,n)?(e==null||e.warn(Gi(ve,n,Qt)),!1):!0,_a=n=>{const e=Date.now(),t=n||Se;return{id:e,expiresAt:e+t,timeout:t,sessionStart:void 0,autoTrack:!0}},Oa=(n,e)=>({id:Aa(n,e)?n:Ta(),sessionStart:void 0,manualTrack:!0}),Ee=n=>n===B||n===$||n===F||n===V,ct=()=>Fn(),Pa=n=>{const e=Gn(),t={};return Object.keys(e).forEach(s=>{t[s]=(n==null?void 0:n[s])||e[s]}),t.initial_referrer=(n==null?void 0:n.initial_referrer)||o.session.initialReferrer.value,t.initial_referring_domain=(n==null?void 0:n.initial_referring_domain)||o.session.initialReferringDomain.value,t},Na=(n,e)=>{const t=(e==null?void 0:e.page)||{},s=n,i=Gn();return Object.keys(i).forEach(r=>{D(s[r])&&(s[r]=t[r]||i[r])}),D(s.initial_referrer)&&(s.initial_referrer=t.initial_referrer||o.session.initialReferrer.value),D(s.initial_referring_domain)&&(s.initial_referring_domain=t.initial_referring_domain||o.session.initialReferringDomain.value),s},qe=(n,e,t)=>{v(n)&&Object.keys(n).forEach(s=>{(Xe.includes(s)||Xe.includes(s.toLowerCase()))&&(t==null||t.warn(wi(an,s,e,Xe)))})},ka=(n,e)=>{const{properties:t,traits:s,context:i}=n,{traits:r}=i;qe(t,"properties",e),qe(s,"traits",e),qe(r,"context.traits",e)},Ca=(n,e)=>{e.anonymousId&&C(e.anonymousId)&&(n.anonymousId=e.anonymousId),v(e.integrations)&&(n.integrations=e.integrations),e.originalTimestamp&&C(e.originalTimestamp)&&(n.originalTimestamp=e.originalTimestamp)},Da=(n,e,t)=>{let s=n;return Object.keys(e).forEach(i=>{if(!Ra.includes(i)&&!Kt.includes(i)){if(i!=="context")s=N(s,{[i]:e[i]});else if(!D(e[i])&&v(e[i])){const r={};Object.keys(e[i]).forEach(a=>{Kt.includes(a)||(r[a]=e[i][a])}),s=N(s,{...r})}}}),s},La=()=>{var n;return o.loadOptions.value.useGlobalIntegrationsConfigInEvents&&(v((n=o.consents.postConsent.value)==null?void 0:n.integrations)||v(o.nativeDestinations.loadOnlyIntegrations.value))},wa=(n,e)=>{v(e)&&(Ca(n,e),n.context=Da(n.context,e))},Ma=n=>{var t;let e;return La()?e=b(((t=o.consents.postConsent.value)==null?void 0:t.integrations)??o.nativeDestinations.loadOnlyIntegrations.value):v(n)?e=n:e=He,e},fe=(n,e,t,s)=>{var a,l,u;const i={channel:ba,context:{traits:b(o.session.userTraits.value),sessionId:o.session.sessionInfo.value.id||void 0,sessionStart:o.session.sessionInfo.value.sessionStart||void 0,...o.consents.enabled.value&&{consentManagement:{deniedConsentIds:b(o.consents.data.value.deniedConsentIds),allowedConsentIds:b(o.consents.data.value.allowedConsentIds),provider:o.consents.provider.value,resolutionStrategy:o.consents.resolutionStrategy.value}},"ua-ch":o.context["ua-ch"].value,app:o.context.app.value,library:o.context.library.value,userAgent:o.context.userAgent.value,os:o.context.os.value,locale:o.context.locale.value,screen:o.context.screen.value,campaign:Ko(globalThis.location.href),page:Pa(t),timezone:o.context.timezone.value},originalTimestamp:Sa(),integrations:He,messageId:Fn(),userId:n.userId||o.session.userId.value};Ee((a=o.storage.entries.value.anonymousId)==null?void 0:a.type)?i.anonymousId=o.session.anonymousId.value:i.anonymousId=ct(),o.storage.trulyAnonymousTracking.value&&(i.context.trulyAnonymousTracking=!0),n.type==="identify"&&(i.context.traits=((l=o.storage.entries.value.userTraits)==null?void 0:l.type)!==ie?b(o.session.userTraits.value):n.context.traits),n.type==="group"&&((n.groupId||o.session.groupId.value)&&(i.groupId=n.groupId||o.session.groupId.value),(n.traits||o.session.groupTraits.value)&&(i.traits=((u=o.storage.entries.value.groupTraits)==null?void 0:u.type)!==ie?b(o.session.groupTraits.value):n.traits));const r=N(n,i);return r.event===void 0&&(r.event=null),r.properties===void 0&&(r.properties=null),wa(r,e),ka(r,s),r.integrations=Ma(r.integrations),r};class Ua{constructor(e){this.logger=e}generatePageEvent(e,t,s,i){let r=s??{};return r.name=t,r.category=e,r=Na(r,i),fe({properties:r,name:t,category:e,type:"page"},i,r,this.logger)}generateTrackEvent(e,t,s){return fe({properties:t,event:e,type:"track"},s,void 0,this.logger)}generateIdentifyEvent(e,t,s){return fe({userId:e,type:"identify",context:{traits:t}},s,void 0,this.logger)}generateAliasEvent(e,t,s){const r=fe({previousId:t,type:"alias"},s,void 0,this.logger);return r.userId=e??r.userId,r}generateGroupEvent(e,t,s){const i={type:"group"};return e&&(i.groupId=e),t&&(i.traits=t),fe(i,s,void 0,this.logger)}create(e){let t;switch(e.type){case"page":t=this.generatePageEvent(e.category,e.name,e.properties,e.options);break;case"track":t=this.generateTrackEvent(e.name,e.properties,e.options);break;case"identify":t=this.generateIdentifyEvent(e.userId,e.traits,e.options);break;case"alias":t=this.generateAliasEvent(e.to,e.from,e.options);break;case"group":t=this.generateGroupEvent(e.groupId,e.traits,e.options);break}return t}}class $a{constructor(e,t,s,i){this.eventRepository=e,this.userSessionManager=t,this.errorHandler=s,this.logger=i,this.eventFactory=new Ua(this.logger),this.onError=this.onError.bind(this)}init(){this.eventRepository.init()}resume(){this.eventRepository.resume()}addEvent(e){this.userSessionManager.refreshSession();const t=this.eventFactory.create(e);t?this.eventRepository.enqueue(t,e.callback):this.onError(new Error(ii))}onError(e,t,s){if(this.errorHandler)this.errorHandler.onError(e,an,t,s);else throw e}}class Ba{constructor(e,t,s,i,r){this.storeManager=i,this.pluginsManager=s,this.logger=t,this.errorHandler=e,this.httpClient=r,this.onError=this.onError.bind(this),this.serverSideCookieDebounceFuncs={}}init(){this.syncStorageDataToState(),this.registerEffects()}syncStorageDataToState(){this.migrateStorageIfNeeded(),this.migrateDataFromPreviousStorage(),this.setUserId(this.getUserId()),this.setUserTraits(this.getUserTraits()),this.setGroupId(this.getGroupId()),this.setGroupTraits(this.getGroupTraits());const{externalAnonymousIdCookieName:e,anonymousIdOptions:t}=o.loadOptions.value;let s;de(e)&&typeof e=="string"&&(s=this.getExternalAnonymousIdByCookieName(e)),this.setAnonymousId(s??this.getAnonymousId(t)),this.setAuthToken(this.getAuthToken()),this.setInitialReferrerInfo(),this.configureSessionTracking()}configureSessionTracking(){let e=this.getSessionInfo();if(this.isPersistenceEnabledForStorageEntry("sessionInfo")){const t=this.getConfiguredSessionTrackingInfo(),s=e??ur;e={...s,...t,autoTrack:t.autoTrack&&s.manualTrack!==!0}}o.session.sessionInfo.value=this.isPersistenceEnabledForStorageEntry("sessionInfo")?e:R.sessionInfo,o.session.sessionInfo.value.autoTrack&&this.startOrRenewAutoTracking(o.session.sessionInfo.value)}setInitialReferrerInfo(){const e=this.getInitialReferrer(),t=this.getInitialReferringDomain();if(e&&t)this.setInitialReferrer(e),this.setInitialReferringDomain(t);else{const s=e||Bn();this.setInitialReferrer(s),this.setInitialReferringDomain(Mn(s))}}isPersistenceEnabledForStorageEntry(e){var t;return Ee((t=o.storage.entries.value[e])==null?void 0:t.type)}migrateDataFromPreviousStorage(){const e=o.storage.entries.value,t=[B,$,F];Object.keys(e).forEach(s=>{var l,u;const i=s,r=(l=e[i])==null?void 0:l.type,a=(u=this.storeManager)==null?void 0:u.getStore(ae[r]);a&&t.forEach(d=>{var y;const f=(y=this.storeManager)==null?void 0:y.getStore(ae[d]);if(f&&d!==r){const O=f.get(oe[i]);cs(O)&&a.set(oe[i],O),f.remove(oe[i])}})})}migrateStorageIfNeeded(){if(!o.storage.migrate.value)return;const e=[On,Pn,Nn],t=[];e.forEach(s=>{var r;const i=(r=this.storeManager)==null?void 0:r.getStore(s);i&&t.push(i)}),Object.keys(oe).forEach(s=>{const i=oe[s];t.forEach(r=>{var l;const a=(l=this.pluginsManager)==null?void 0:l.invokeSingle("storage.migrate",i,r.engine,this.errorHandler,this.logger);H(a)||r.set(i,a)})})}getConfiguredSessionTrackingInfo(){var i,r,a,l,u;let e=((i=o.loadOptions.value.sessions)==null?void 0:i.autoTrack)!==!1;if(!e)return{autoTrack:e};let t;const s=(r=o.loadOptions.value.sessions)==null?void 0:r.timeout;return Hn(s)?t=s:((a=this.logger)==null||a.warn(Ui(ve,s,Se)),t=Se),t===0&&((l=this.logger)==null||l.warn($i(ve)),e=!1),t>0&&t<Ot&&((u=this.logger)==null||u.warn(Bi(ve,t,Ot))),{timeout:t,autoTrack:e}}onError(e,t){if(this.errorHandler)this.errorHandler.onError(e,ve,t);else throw e}getEncryptedCookieData(e,t){const s=[];return e.forEach(i=>{const r=t==null?void 0:t.encrypt(q(i.value,!1,[],this.logger));de(r)&&s.push({name:i.name,value:r})}),s}makeRequestToSetCookie(e,t){var s,i,r,a,l,u,d,f;(f=this.httpClient)==null||f.getAsyncData({url:o.serverCookies.dataServiceUrl.value,options:{method:"POST",data:q({reqType:"setCookies",workspaceId:(s=o.source.value)==null?void 0:s.workspaceId,data:{options:{maxAge:(i=o.storage.cookie.value)==null?void 0:i.maxage,path:(r=o.storage.cookie.value)==null?void 0:r.path,domain:(a=o.storage.cookie.value)==null?void 0:a.domain,sameSite:(l=o.storage.cookie.value)==null?void 0:l.samesite,secure:(u=o.storage.cookie.value)==null?void 0:u.secure,expires:(d=o.storage.cookie.value)==null?void 0:d.expires},cookies:e}}),sendRawData:!0,withCredentials:!0},isRawResponse:!0,callback:t})}setServerSideCookies(e,t,s){try{const i=this.getEncryptedCookieData(e,s);i.length>0&&this.makeRequestToSetCookie(i,(r,a)=>{var l,u,d;((l=a==null?void 0:a.xhr)==null?void 0:l.status)===200?e.forEach(f=>{var p;const y=s==null?void 0:s.get(f.name),O=q(f.value,!1,[]);q(y,!1,[])!==O&&((p=this.logger)==null||p.error(Pi(f.name)),t&&t(f.name,f.value))}):((d=this.logger)==null||d.error(Oi((u=a==null?void 0:a.xhr)==null?void 0:u.status)),e.forEach(f=>{t&&t(f.name,f.value)}))})}catch(i){this.onError(i,Ni),e.forEach(r=>{t&&t(r.name,r.value)})}}syncValueToStorage(e,t){var r,a,l;const s=o.storage.entries.value,i=(r=s[e])==null?void 0:r.type;if(Ee(i)){const u=(a=this.storeManager)==null?void 0:a.getStore(ae[i]),d=(l=s[e])==null?void 0:l.key;t&&(C(t)||Be(t))?o.serverCookies.isEnabledServerSideCookies.value&&i===B?(this.serverSideCookieDebounceFuncs[e]&&globalThis.clearTimeout(this.serverSideCookieDebounceFuncs[e]),this.serverSideCookieDebounceFuncs[e]=globalThis.setTimeout(()=>{this.setServerSideCookies([{name:d,value:t}],(f,y)=>{u==null||u.set(f,y)},u)},lr)):u==null||u.set(d,t):u==null||u.remove(d)}}registerEffects(){kn.forEach(e=>{W(()=>{this.syncValueToStorage(e,o.session[e].value)})})}setAnonymousId(e,t){var i;let s=e;this.isPersistenceEnabledForStorageEntry("anonymousId")?(!s&&t&&(s=(i=this.pluginsManager)==null?void 0:i.invokeSingle("userSession.anonymousIdGoogleLinker",t)),s=s||ct()):s=R.anonymousId,o.session.anonymousId.value=s}getAnonymousId(e){var s,i;const t=(s=o.storage.entries.value.anonymousId)==null?void 0:s.type;if(Ee(t)){let r=this.getEntryValue("anonymousId");!r&&e&&(r=(i=this.pluginsManager)==null?void 0:i.invokeSingle("storage.getAnonymousId",G,e)),o.session.anonymousId.value=r||ct()}return o.session.anonymousId.value}getEntryValue(e){var i,r,a;const t=o.storage.entries.value,s=(i=t[e])==null?void 0:i.type;if(Ee(s)){const l=(r=this.storeManager)==null?void 0:r.getStore(ae[s]),u=(a=t[e])==null?void 0:a.key;return(l==null?void 0:l.get(u))??null}return null}getExternalAnonymousIdByCookieName(e){const t=G(B);return t!=null&&t.isEnabled?t.getItem(e)??null:null}getUserId(){return this.getEntryValue("userId")}getUserTraits(){return this.getEntryValue("userTraits")}getGroupId(){return this.getEntryValue("groupId")}getGroupTraits(){return this.getEntryValue("groupTraits")}getInitialReferrer(){return this.getEntryValue("initialReferrer")}getInitialReferringDomain(){return this.getEntryValue("initialReferringDomain")}getSessionInfo(){return this.getEntryValue("sessionInfo")}getAuthToken(){return this.getEntryValue("authToken")}getSessionId(){const e=this.getSessionInfo()??R.sessionInfo;return e.autoTrack&&!zt(e.expiresAt)||e.manualTrack?e.id??null:null}refreshSession(){let e=this.getSessionInfo()??R.sessionInfo;(e.autoTrack||e.manualTrack)&&(e.autoTrack&&(this.startOrRenewAutoTracking(e),e=o.session.sessionInfo.value),e.sessionStart===void 0?e={...e,sessionStart:!0}:e.sessionStart&&(e={...e,sessionStart:!1})),o.session.sessionInfo.value=e,o.lifecycle.status.value!=="readyExecuted"&&this.syncValueToStorage("sessionInfo",e)}reset(e,t){const{session:s}=o,{manualTrack:i,autoTrack:r}=s.sessionInfo.value;M(()=>{s.userId.value=R.userId,s.userTraits.value=R.userTraits,s.groupId.value=R.groupId,s.groupTraits.value=R.groupTraits,s.authToken.value=R.authToken,e&&this.setAnonymousId(),!t&&(r?(s.sessionInfo.value=R.sessionInfo,this.startOrRenewAutoTracking(s.sessionInfo.value)):i&&this.startManualTrackingInternal())})}setUserId(e){o.session.userId.value=this.isPersistenceEnabledForStorageEntry("userId")&&e?e:R.userId}setUserTraits(e){o.session.userTraits.value=this.isPersistenceEnabledForStorageEntry("userTraits")&&e?N(o.session.userTraits.value??R.userTraits,e):R.userTraits}setGroupId(e){o.session.groupId.value=this.isPersistenceEnabledForStorageEntry("groupId")&&e?e:R.groupId}setGroupTraits(e){o.session.groupTraits.value=this.isPersistenceEnabledForStorageEntry("groupTraits")&&e?N(o.session.groupTraits.value??R.groupTraits,e):R.groupTraits}setInitialReferrer(e){o.session.initialReferrer.value=this.isPersistenceEnabledForStorageEntry("initialReferrer")&&e?e:R.initialReferrer}setInitialReferringDomain(e){o.session.initialReferringDomain.value=this.isPersistenceEnabledForStorageEntry("initialReferringDomain")&&e?e:R.initialReferringDomain}startOrRenewAutoTracking(e){if(zt(e.expiresAt))o.session.sessionInfo.value=_a(e.timeout);else{const t=Date.now(),s=e.timeout;o.session.sessionInfo.value=N(e,{expiresAt:t+s})}}start(e){o.session.sessionInfo.value=Oa(e,this.logger)}startManualTrackingInternal(){this.start(Date.now())}end(){o.session.sessionInfo.value=R.sessionInfo}setAuthToken(e){o.session.authToken.value=this.isPersistenceEnabledForStorageEntry("authToken")&&e?e:R.authToken}}const Ga=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],Fa=(n,e)=>{var a,l,u,d;const t=b(e);return C(t.setCookieDomain)||delete t.setCookieDomain,["Strict","Lax","None"].includes(t.sameSiteCookie)||delete t.sameSiteCookie,t.secureCookie=t.secureCookie===!0,["none","default","full"].includes(t.uaChTrackLevel)||delete t.uaChTrackLevel,v(t.integrations)||delete t.integrations,t.plugins=t.plugins??Ga,t.useGlobalIntegrationsConfigInEvents=t.useGlobalIntegrationsConfigInEvents===!0,t.bufferDataPlaneEventsUntilReady=t.bufferDataPlaneEventsUntilReady===!0,t.sendAdblockPage=t.sendAdblockPage===!0,t.useServerSideCookies=t.useServerSideCookies===!0,t.dataServiceEndpoint&&typeof t.dataServiceEndpoint!="string"&&delete t.dataServiceEndpoint,v(t.sendAdblockPageOptions)||delete t.sendAdblockPageOptions,A(t.loadIntegration)?t.loadIntegration=t.loadIntegration===!0:delete t.loadIntegration,v(t.storage)?(t.storage=te(t.storage),t.storage.migrate=((a=t.storage)==null?void 0:a.migrate)===!0):delete t.storage,v(t.beaconQueueOptions)?t.beaconQueueOptions=te(t.beaconQueueOptions):delete t.beaconQueueOptions,v(t.destinationsQueueOptions)?t.destinationsQueueOptions=te(t.destinationsQueueOptions):delete t.destinationsQueueOptions,v(t.queueOptions)?t.queueOptions=te(t.queueOptions):delete t.queueOptions,t.lockIntegrationsVersion=t.lockIntegrationsVersion===!0,t.lockPluginsVersion=t.lockPluginsVersion===!0,xn(t.dataPlaneEventsBufferTimeout)||delete t.dataPlaneEventsBufferTimeout,v((l=t.storage)==null?void 0:l.cookie)?t.storage.cookie=te((d=t.storage)==null?void 0:d.cookie):(u=t.storage)==null||delete u.cookie,v(t.preConsent)?t.preConsent=te(t.preConsent):delete t.preConsent,N(n,t)},Wt="dataplaneEventsQueue",Yt="destinationsEventsQueue",xa="transformEvent",Ha=(n,e)=>Object.keys(n).filter(t=>n[t]!==!0||!e[t]).reduce((t,s)=>{const i=b(t);return i[s]=n[s],i},{}),ja=(n,e)=>{const t=b(n),s=n.integrations??He,i=e.nativeDestinations.integrationsConfig.value,r=Ha(s,i);return t.integrations=N(i,r),t},Va=n=>{var e,t,s;return n.consents.preConsent.value.enabled&&((e=n.consents.preConsent.value.events)==null?void 0:e.delivery)==="buffer"&&(((t=n.consents.preConsent.value.storage)==null?void 0:t.strategy)==="session"||((s=n.consents.preConsent.value.storage)==null?void 0:s.strategy)==="none")};class Ka{constructor(e,t,s,i){this.pluginsManager=e,this.errorHandler=s,this.logger=i,this.httpClient=new vt(s,i),this.storeManager=t,this.onError=this.onError.bind(this)}init(){try{this.dataplaneEventsQueue=this.pluginsManager.invokeSingle(`${Wt}.init`,o,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(s){this.onError(s,Qi)}try{this.dmtEventsQueue=this.pluginsManager.invokeSingle(`${xa}.init`,o,this.pluginsManager,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(s){this.onError(s,zi)}try{this.destinationsEventsQueue=this.pluginsManager.invokeSingle(`${Yt}.init`,o,this.pluginsManager,this.storeManager,this.dmtEventsQueue,this.errorHandler,this.logger)}catch(s){this.onError(s,Ki)}W(()=>{var s,i;o.nativeDestinations.clientDestinationsReady.value===!0&&((s=this.destinationsEventsQueue)==null||s.start(),(i=this.dmtEventsQueue)==null||i.start())});const e=Va(o);let t;W(()=>{var r,a;const s=o.loadOptions.value.bufferDataPlaneEventsUntilReady===!0&&o.nativeDestinations.clientDestinationsReady.value===!1;(o.nativeDestinations.activeDestinations.value.some(l=>Dr(l))===!1||s===!1)&&!e&&((r=this.dataplaneEventsQueue)==null?void 0:r.scheduleTimeoutActive)!==!0&&(globalThis.clearTimeout(t),(a=this.dataplaneEventsQueue)==null||a.start())}),o.loadOptions.value.bufferDataPlaneEventsUntilReady===!0&&(t=globalThis.setTimeout(()=>{var s,i;((s=this.dataplaneEventsQueue)==null?void 0:s.scheduleTimeoutActive)!==!0&&((i=this.dataplaneEventsQueue)==null||i.start())},o.loadOptions.value.dataPlaneEventsBufferTimeout))}resume(){var e,t,s,i;((e=this.dataplaneEventsQueue)==null?void 0:e.scheduleTimeoutActive)!==!0&&(o.consents.postConsent.value.discardPreConsentEvents&&((t=this.dataplaneEventsQueue)==null||t.clear(),(s=this.destinationsEventsQueue)==null||s.clear()),(i=this.dataplaneEventsQueue)==null||i.start())}enqueue(e,t){let s;try{s=ja(e,o),this.pluginsManager.invokeSingle(`${Wt}.enqueue`,o,this.dataplaneEventsQueue,s,this.errorHandler,this.logger)}catch(i){this.onError(i,Yi)}try{const i=b(e);this.pluginsManager.invokeSingle(`${Yt}.enqueue`,o,this.destinationsEventsQueue,i,this.errorHandler,this.logger)}catch(i){this.onError(i,Wi)}try{t==null||t(s)}catch(i){this.onError(i,Vi)}}onError(e,t,s){if(this.errorHandler)this.errorHandler.onError(e,ys,t,s);else throw e}}const Xt=n=>{const e=new CustomEvent(n,{detail:{analyticsInstance:globalThis.rudderanalytics},bubbles:!0,cancelable:!0,composed:!0});globalThis.document.dispatchEvent(e)};class qt{constructor(){this.preloadBuffer=new vn,this.initialized=!1,this.errorHandler=xe,this.logger=j,this.externalSrcLoader=new cn(this.errorHandler,this.logger),this.capabilitiesManager=new pa(this.errorHandler,this.logger),this.httpClient=Hr}load(e,t,s={}){var a;if(o.lifecycle.status.value)return;let i=b(t),r=b(s);nn(t)&&(r=t,i=void 0),M(()=>{o.lifecycle.writeKey.value=e,o.lifecycle.dataPlaneUrl.value=i,o.loadOptions.value=Fa(o.loadOptions.value,r),o.lifecycle.status.value="mounted"}),o.loadOptions.value.logLevel&&((a=this.logger)==null||a.setMinLogLevel(o.loadOptions.value.logLevel)),Ge("state",o,e),this.startLifecycle()}startLifecycle(){W(()=>{try{switch(o.lifecycle.status.value){case"mounted":this.onMounted();break;case"browserCapabilitiesReady":this.onBrowserCapabilitiesReady();break;case"configured":this.onConfigured();break;case"pluginsLoading":break;case"pluginsReady":this.onPluginsReady();break;case"initialized":this.onInitialized();break;case"loaded":this.onLoaded();break;case"destinationsLoading":break;case"destinationsReady":this.onDestinationsReady();break;case"ready":this.onReady();break;case"readyExecuted":default:break}}catch(e){const t="Failed to load the SDK";this.errorHandler.onError(Re(e,t),Ve)}})}onBrowserCapabilitiesReady(){Us(this),this.prepareInternalServices(),this.loadConfig()}onLoaded(){this.processBufferedEvents(),o.consents.preConsent.value.enabled===!0?o.lifecycle.status.value="ready":this.loadDestinations()}onMounted(){this.capabilitiesManager.init()}enqueuePreloadBufferEvents(e){Array.isArray(e)&&e.forEach(t=>this.preloadBuffer.enqueue(b(t)))}processDataInPreloadBuffer(){for(;this.preloadBuffer.size()>0;){const e=this.preloadBuffer.dequeue();e&&$s([...e],this)}}prepareInternalServices(){this.pluginsManager=new Fr(Tn,this.errorHandler,this.logger),this.storeManager=new Mo(this.pluginsManager,this.errorHandler,this.logger),this.configManager=new la(this.httpClient,this.errorHandler,this.logger),this.userSessionManager=new Ba(this.errorHandler,this.logger,this.pluginsManager,this.storeManager,this.httpClient),this.eventRepository=new Ka(this.pluginsManager,this.storeManager,this.errorHandler,this.logger),this.eventManager=new $a(this.eventRepository,this.userSessionManager,this.errorHandler,this.logger)}loadConfig(){var e;o.lifecycle.writeKey.value&&this.httpClient.setAuthHeader(o.lifecycle.writeKey.value),(e=this.configManager)==null||e.init()}onPluginsReady(){var e,t,s,i,r;this.errorHandler.init(this.externalSrcLoader),(e=this.storeManager)==null||e.init(),(t=this.userSessionManager)==null||t.init(),o.consents.enabled.value&&!o.consents.initialized.value&&((s=this.pluginsManager)==null||s.invokeSingle("consentManager.init",o,this.logger),o.consents.preConsent.value.enabled===!1&&((i=this.pluginsManager)==null||i.invokeSingle("consentManager.updateConsentsInfo",o,this.storeManager,this.logger))),(r=this.eventManager)==null||r.init(),o.lifecycle.status.value="initialized"}onConfigured(){var e;(e=this.pluginsManager)==null||e.init()}onInitialized(){this.processDataInPreloadBuffer(),g(o.loadOptions.value.onLoaded)&&o.loadOptions.value.onLoaded(globalThis.rudderanalytics),M(()=>{o.lifecycle.loaded.value=!0,o.lifecycle.status.value="loaded"}),this.initialized=!0,Xt("RSA_Initialised")}onReady(){o.lifecycle.status.value="readyExecuted",o.eventBuffer.readyCallbacksArray.value.forEach(e=>{try{e()}catch(t){this.errorHandler.onError(t,Ve,Dt)}}),Xt("RSA_Ready")}processBufferedEvents(){let e=o.eventBuffer.toBeProcessedArray.value;for(;e.length>0;){const t=e.shift();if(o.eventBuffer.toBeProcessedArray.value=e,t){const s=t[0];g(this[s])&&this[s](...t.slice(1),!0)}e=o.eventBuffer.toBeProcessedArray.value}}loadDestinations(){var t,s;if(o.nativeDestinations.clientDestinationsReady.value)return;(t=this.pluginsManager)==null||t.invokeSingle("nativeDestinations.setActiveDestinations",o,this.pluginsManager,this.errorHandler,this.logger);const e=o.nativeDestinations.activeDestinations.value.length;if(e===0){o.lifecycle.status.value="destinationsReady";return}o.lifecycle.status.value="destinationsLoading",(s=this.pluginsManager)==null||s.invokeSingle("nativeDestinations.load",o,this.externalSrcLoader,this.errorHandler,this.logger),W(()=>{(e===0||o.nativeDestinations.initializedDestinations.value.length+o.nativeDestinations.failedDestinations.value.length===e)&&M(()=>{o.lifecycle.status.value="destinationsReady",o.nativeDestinations.clientDestinationsReady.value=!0})})}onDestinationsReady(){o.lifecycle.status.value!=="ready"&&(o.lifecycle.status.value="ready")}ready(e,t=!1){const s="ready";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}if(this.errorHandler.leaveBreadcrumb(`New ${s} invocation`),!g(e)){this.logger.error(bi(Es));return}if(o.lifecycle.status.value==="readyExecuted")try{e()}catch(i){this.errorHandler.onError(i,Ve,Dt)}else o.eventBuffer.readyCallbacksArray.value=[...o.eventBuffer.readyCallbacksArray.value,e]}page(e,t=!1){var i;const s="page";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,(i=this.eventManager)==null||i.addEvent({type:"page",category:e.category,name:e.name,properties:e.properties,options:e.options,callback:e.callback}),o.capabilities.isAdBlocked.value===!0&&e.category!==It&&this.page(Me(It,Rs,{path:Is},o.loadOptions.value.sendAdblockPageOptions))}track(e,t=!1){var i;const s="track";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,(i=this.eventManager)==null||i.addEvent({type:s,name:e.name||void 0,properties:e.properties,options:e.options,callback:e.callback})}identify(e,t=!1){var r,a,l;const s="identify";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,!!(e.userId&&o.session.userId.value&&e.userId!==o.session.userId.value)&&this.reset(),x(e.userId)||(r=this.userSessionManager)==null||r.setUserId(e.userId),(a=this.userSessionManager)==null||a.setUserTraits(e.traits),(l=this.eventManager)==null||l.addEvent({type:s,userId:e.userId,traits:e.traits,options:e.options,callback:e.callback})}alias(e,t=!1){var r,a,l;const s="alias";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1;const i=e.from??((r=this.userSessionManager)==null?void 0:r.getUserId())??((a=this.userSessionManager)==null?void 0:a.getAnonymousId());(l=this.eventManager)==null||l.addEvent({type:s,to:e.to,from:i,options:e.options,callback:e.callback})}group(e,t=!1){var i,r,a;const s="group";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,x(e.groupId)||(i=this.userSessionManager)==null||i.setGroupId(e.groupId),(r=this.userSessionManager)==null||r.setGroupTraits(e.traits),(a=this.eventManager)==null||a.addEvent({type:s,groupId:e.groupId,traits:e.traits,options:e.options,callback:e.callback})}reset(e,t=!1){var i;const s="reset";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} invocation, resetAnonymousId: ${e}`),(i=this.userSessionManager)==null||i.reset(e)}getAnonymousId(e){var t;return(t=this.userSessionManager)==null?void 0:t.getAnonymousId(e)}setAnonymousId(e,t,s=!1){var r;const i="setAnonymousId";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[i,e,t]];return}this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),(r=this.userSessionManager)==null||r.setAnonymousId(e,t)}getUserId(){return o.session.userId.value}getUserTraits(){return o.session.userTraits.value}getGroupId(){return o.session.groupId.value}getGroupTraits(){return o.session.groupTraits.value}startSession(e,t=!1){var i;const s="startSession";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} invocation`),(i=this.userSessionManager)==null||i.start(e)}endSession(e=!1){var s;const t="endSession";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[t]];return}this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),(s=this.userSessionManager)==null||s.end()}getSessionId(){var t;return((t=this.userSessionManager)==null?void 0:t.getSessionId())??null}consent(e,t=!1){var i,r,a,l;const s="consent";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb("New consent invocation"),M(()=>{o.consents.preConsent.value={...o.consents.preConsent.value,enabled:!1},o.consents.postConsent.value=qo(e);const{initialized:u,consentsData:d}=Un(o.consents.postConsent.value.consentManagement,this.logger);o.consents.initialized.value=u||o.consents.initialized.value,o.consents.data.value=d}),o.consents.enabled.value&&!o.consents.initialized.value&&((i=this.pluginsManager)==null||i.invokeSingle("consentManager.updateConsentsInfo",o,this.storeManager,this.logger)),(r=this.storeManager)==null||r.initializeStorageState(),(a=this.userSessionManager)==null||a.syncStorageDataToState(),(l=this.eventManager)==null||l.resume(),this.loadDestinations(),this.sendTrackingEvents(t)}sendTrackingEvents(e){if(o.consents.postConsent.value.trackConsent){const t=ht(Ts);e?o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,["track",t]]:this.track(t)}if(o.consents.postConsent.value.sendPageEvent){const t=Me();e?o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,["page",t]]:this.page(t)}}setAuthToken(e){var t;(t=this.userSessionManager)==null||t.setAuthToken(e)}}const ue=class ue{constructor(){S(this,"analyticsInstances",{});S(this,"defaultAnalyticsKey","");S(this,"logger",j);if(ue.globalSingleton)return ue.globalSingleton;xe.attachErrorListeners(),this.setDefaultInstanceKey=this.setDefaultInstanceKey.bind(this),this.getAnalyticsInstance=this.getAnalyticsInstance.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.triggerBufferedLoadEvent=this.triggerBufferedLoadEvent.bind(this),this.page=this.page.bind(this),this.track=this.track.bind(this),this.identify=this.identify.bind(this),this.alias=this.alias.bind(this),this.group=this.group.bind(this),this.reset=this.reset.bind(this),this.getAnonymousId=this.getAnonymousId.bind(this),this.setAnonymousId=this.setAnonymousId.bind(this),this.getUserId=this.getUserId.bind(this),this.getUserTraits=this.getUserTraits.bind(this),this.getGroupId=this.getGroupId.bind(this),this.getGroupTraits=this.getGroupTraits.bind(this),this.startSession=this.startSession.bind(this),this.endSession=this.endSession.bind(this),this.getSessionId=this.getSessionId.bind(this),this.setAuthToken=this.setAuthToken.bind(this),this.consent=this.consent.bind(this),ue.globalSingleton=this,this.triggerBufferedLoadEvent(),globalThis.rudderanalytics=this}setDefaultInstanceKey(e){e&&(this.defaultAnalyticsKey=e)}getAnalyticsInstance(e){const t=e??this.defaultAnalyticsKey;return!!this.analyticsInstances[t]||(this.analyticsInstances[t]=new qt),this.analyticsInstances[t]}load(e,t,s){if(!C(e)){this.logger.error(Hi(bt,e));return}this.analyticsInstances[e]||(this.setDefaultInstanceKey(e),this.analyticsInstances[e]=new qt,this.getAnalyticsInstance(e).load(e,t,s))}triggerBufferedLoadEvent(){const e=Array.isArray(globalThis.rudderanalytics)?globalThis.rudderanalytics:[];Ms(e);const t=ws(e);Ge(et,b(e)),t.length>0&&(t.shift(),this.load.apply(null,t))}ready(e){this.getAnalyticsInstance().ready(e)}page(e,t,s,i,r){this.getAnalyticsInstance().page(Me(e,t,s,i,r))}track(e,t,s,i){this.getAnalyticsInstance().track(ht(e,t,s,i))}identify(e,t,s,i){this.getAnalyticsInstance().identify(sn(e,t,s,i))}alias(e,t,s,i){this.getAnalyticsInstance().alias(rn(e,t,s,i))}group(e,t,s,i){if(arguments.length===0){this.logger.error(ji(bt));return}this.getAnalyticsInstance().group(on(e,t,s,i))}reset(e){this.getAnalyticsInstance().reset(e)}getAnonymousId(e){return this.getAnalyticsInstance().getAnonymousId(e)}setAnonymousId(e,t){this.getAnalyticsInstance().setAnonymousId(e,t)}getUserId(){return this.getAnalyticsInstance().getUserId()}getUserTraits(){return this.getAnalyticsInstance().getUserTraits()}getGroupId(){return this.getAnalyticsInstance().getGroupId()}getGroupTraits(){return this.getAnalyticsInstance().getGroupTraits()}startSession(e){return this.getAnalyticsInstance().startSession(e)}endSession(){return this.getAnalyticsInstance().endSession()}getSessionId(){return this.getAnalyticsInstance().getSessionId()}setAuthToken(e){return this.getAnalyticsInstance().setAuthToken(e)}consent(e){return this.getAnalyticsInstance().consent(e)}};S(ue,"globalSingleton",null);let dt=ue;function Qa(){const n=document.querySelector('[name="fields[anonymous_id]"]');n!==null?(n.value=z.getAnonymousId(),console.log("RudderStack Field Update complete - ",z.getAnonymousId())):console.log("anonymousIdField is null")}function Jt(){[...document.getElementsByTagName("a")].forEach(t=>{if(t.addEventListener("click",r=>{const a=r.currentTarget,l={eventElement:"a",target:a.href,title:a.innerText,id_html:a.id,className:a.className.split(" "),ariaLabel:a.getAttribute("aria-label")};z.track("Clicked A Link",l)},{once:!0}),!t.href||!t.hasAttribute("href"))return!1;const s=new URL(t.href);s.origin!==location.origin&&!s.searchParams.get("anonymous_id")&&(s.searchParams.append("anonymous_id",z.getAnonymousId()),t.href=s)}),[...document.getElementsByTagName("button")].forEach(t=>{t.addEventListener("click",s=>{const i=s.currentTarget,r={eventElement:"button",title:i.innerText,id_html:i.id,className:i.className.split(" "),ariaLabel:i.getAttribute("aria-label")};z.track("Pressed A Button",r)},{once:!0})})}function jn(n=0){if(n>5)return!1;setTimeout(()=>{"htmx"in window?(Jt(),window.htmx.on("htmx:afterSwap",()=>{Jt()})):jn(n+1)},500)}const z=new dt;z.load("2Fivwkm2WzdbgiuTksdgWz729mz","https://conversionwbv.dataplane.rudderstack.com");z.ready(()=>{jn(),z.getAnonymousId(),window.addEventListener("onBeforeFormieSubmit",()=>{Qa()})});z.page();
//# sourceMappingURL=site.js.map
